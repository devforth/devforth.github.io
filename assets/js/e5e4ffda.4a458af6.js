"use strict";(self.webpackChunkadminforth=self.webpackChunkadminforth||[]).push([[2179],{2751:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>d,contentTitle:()=>s,default:()=>m,frontMatter:()=>r,metadata:()=>o,toc:()=>l});var i=a(74848),t=a(28453);const r={},s="Bulk AI Flow",o={id:"tutorial/Plugins/bulk-ai-flow",title:"Bulk AI Flow",description:"This plugin allows filling fields in multiple selected records based on data from other fields using LLM.",source:"@site/docs/tutorial/08-Plugins/17-bulk-ai-flow.md",sourceDirName:"tutorial/08-Plugins",slug:"/tutorial/Plugins/bulk-ai-flow",permalink:"/docs/tutorial/Plugins/bulk-ai-flow",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:17,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Email Invite",permalink:"/docs/tutorial/Plugins/email-invite"},next:{title:"Universal Search",permalink:"/docs/tutorial/Plugins/universal-filters"}},d={},l=[{value:"Installation",id:"installation",level:2},{value:"Vision mode",id:"vision-mode",level:2},{value:"Usage",id:"usage",level:2},{value:"Text-to-Text Processing",id:"text-to-text-processing",level:2},{value:"Example: Translate Names to English",id:"example-translate-names-to-english",level:3},{value:"Image-to-Text Analysis (Vision)",id:"image-to-text-analysis-vision",level:2},{value:"Example: Age Detection from Photos",id:"example-age-detection-from-photos",level:3},{value:"Text-to-Image generation or image editing",id:"text-to-image-generation-or-image-editing",level:2},{value:"Example: Creating Cartoon Avatars",id:"example-creating-cartoon-avatars",level:3},{value:"Rate Limiting and Best Practices",id:"rate-limiting-and-best-practices",level:2},{value:"Comparing new and old images",id:"comparing-new-and-old-images",level:2},{value:"Extra data fields",id:"extra-data-fields",level:2},{value:"Allow users to edit generation prompts",id:"allow-users-to-edit-generation-prompts",level:2}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"bulk-ai-flow",children:"Bulk AI Flow"}),"\n",(0,i.jsx)(n.p,{children:"This plugin allows filling fields in multiple selected records based on data from other fields using LLM.\nThis also supports vision tasks so you can ask it to e.g. detect dominant color on image or describe what is on the image. Plugin supports classification to enum options automatically."}),"\n",(0,i.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,i.jsx)(n.p,{children:"To install the plugin:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm install @adminforth/bulk-ai-flow --save\n"})}),"\n",(0,i.jsx)(n.p,{children:"You'll also need an image vision adapter:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm install @adminforth/image-vision-adapter-openai --save\n"})}),"\n",(0,i.jsx)(n.h2,{id:"vision-mode",children:"Vision mode"}),"\n",(0,i.jsx)(n.p,{children:"This mode covers next generations:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"- Image(one or many fields) -> to -> Text/Number/Enum/Boolean(one or many fields)\n- Image(one or many fields) + Text/Number/Enum/Boolean(one or many fields) -> to -> Text/Number/Enum/Boolean(one or many fields)\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Lets try both. Add a column for storing the URL or path to the image in the database, add this statement to the ",(0,i.jsx)(n.code,{children:"./schema.prisma"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'title="./schema.prisma"',children:"model apartments {\n  id                String     @id\n  created_at        DateTime?\n  title             String\n  square_meter      Float?\n  price             Decimal\n  number_of_rooms   Int?\n  description       String?\n  country           String?\n  listed            Boolean\n  realtor_id        String?\n//diff-add\n  apartment_image   String?\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"Migrate prisma schema:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm run makemigration -- --name add-apartment-image-url ; npm run migrate:local\n"})}),"\n",(0,i.jsxs)(n.p,{children:["We will also attach ",(0,i.jsx)(n.a,{href:"/docs/tutorial/Plugins/upload/",children:"upload plugin"})," to this field."]}),"\n",(0,i.jsxs)(n.p,{children:["Add credentials in your ",(0,i.jsx)(n.code,{children:".env"})," file:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'title=".env"',children:"...\n\n//diff-add\nOPENAI_API_KEY=your_secret_openai_key\n\n...\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Add column to ",(0,i.jsx)(n.code,{children:"aparts"})," resource configuration:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'title="./resources/apartments.ts"',children:"//diff-add\nimport BulkAiFlowPlugin  from '@adminforth/bulk-ai-flow';\n//diff-add\nimport AdminForthImageVisionAdapterOpenAi from '@adminforth/image-vision-adapter-openai';\n//diff-add\nimport UploadPlugin from '@adminforth/upload';\n//diff-add\nimport { randomUUID } from 'crypto';\n//diff-add\nimport AdminForthAdapterS3Storage from '@adminforth/storage-adapter-amazon-s3'\n\nexport const admin = new AdminForth({\n  ...\n  resourceId: 'aparts',\n  columns: [\n    ...\n//diff-add\n    {\n//diff-add\n        name: 'apartment_image',\n//diff-add\n        label: 'Image',\n//diff-add\n        showIn: { list: false, create: true, edit: true},\n//diff-add\n    }\n    ...\n  ],\n  plugins: [\n    ...\n  //diff-add\n      new UploadPlugin({\n  //diff-add\n        storageAdapter: new AdminForthAdapterS3Storage({\n  //diff-add\n          bucket: process.env.AWS_BUCKET_NAME,\n  //diff-add\n          region: process.env.AWS_REGION,\n  //diff-add\n          accessKeyId: process.env.AWS_ACCESS_KEY_ID,\n  //diff-add\n          secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY,\n  //diff-add\n          s3ACL: 'public-read',\n  //diff-add\n        }),\n  //diff-add\n        pathColumnName: 'apartment_image',\n  //diff-add\n        allowedFileExtensions: ['jpg', 'jpeg', 'png', 'gif', 'webm', 'webp'],\n  //diff-add\n        filePath: ({originalFilename, originalExtension, contentType}) => \n  //diff-add\n              `aparts/${new Date().getFullYear()}/${randomUUID()}-${originalFilename}.${originalExtension}`,\n  //diff-add\n      }),\n\n      //diff-add\n      new BulkAiFlowPlugin({\n      //diff-add\n        actionName: 'Analyze',\n      //diff-add\n        attachFiles: async ({ record }: { record: any }) => {\n      //diff-add\n        if (!record.apartment_image) {\n      //diff-add\n          return [];\n      //diff-add\n        }\n      //diff-add\n          return [`https://tmpbucket-adminforth.s3.eu-central-1.amazonaws.com/${record.apartment_image}`];\n      //diff-add\n        },\n      //diff-add\n        visionAdapter: new AdminForthImageVisionAdapterOpenAi(\n      //diff-add\n          {\n      //diff-add\n            openAiApiKey:  process.env.OPENAI_API_KEY as string,\n      //diff-add\n            model: 'gpt-5-mini',\n      //diff-add\n          }\n      //diff-add\n        ),\n      //diff-add\n        fillFieldsFromImages: { \n      //diff-add\n          'description': 'describe what is in the image, also take into account that price is {{price}}', \n      //diff-add\n          'country': 'In which country it can be located?', \n      //diff-add\n          'number_of_rooms': 'How many rooms are in the apartment? Just try to guess what is a typical one. If you do not know, just guess',\n      //diff-add\n          'square_meter': 'Try to guess what is the typical square of the apartment in square meters? If you do not know, just guess',\n      //diff-add\n          'listed': 'Is the apartment should be listed for sale? If you do not know, just guess, return boolean value',\n      //diff-add\n        },\n      //diff-add\n      }),\n      //diff-add\n    ],\n\n  \n  ...\n\n});\n"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"\u26a0\ufe0f Make sure your attachFiles function returns a valid array of image URLs or an empty array. Returning anything else may cause an error."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Select fields you want to fill"}),"\n",(0,i.jsx)(n.li,{children:"Click on the three dots menu"}),"\n",(0,i.jsxs)(n.li,{children:["Click analyze\n",(0,i.jsx)(n.img,{alt:"alt text",src:a(61636).A+"",width:"2298",height:"439"})]}),"\n",(0,i.jsx)(n.li,{children:"Wait for finish analyze"}),"\n",(0,i.jsxs)(n.li,{children:["Check and edit result\n",(0,i.jsx)(n.img,{alt:"alt text",src:a(46911).A+"",width:"1744",height:"836"})]}),"\n",(0,i.jsxs)(n.li,{children:["Save changhes\n",(0,i.jsx)(n.img,{alt:"alt text",src:a(93110).A+"",width:"2304",height:"418"})]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"text-to-text-processing",children:"Text-to-Text Processing"}),"\n",(0,i.jsx)(n.p,{children:"This is the most basic plugin usage. You can connect any text completion adapter to fill one or several string/number/boolean fields from other fields."}),"\n",(0,i.jsx)(n.h3,{id:"example-translate-names-to-english",children:"Example: Translate Names to English"}),"\n",(0,i.jsx)(n.p,{children:"Normalize user names by translating them from any language to English for internal processing."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"import CompletionAdapterOpenAIChatGPT from '@adminforth/completion-adapter-open-ai-chat-gpt/index.js';\n\n// Add to your resource plugins array\nnew BulkAiFlowPlugin({\n  actionName: 'Translate surnames',\n  textCompleteAdapter: new CompletionAdapterOpenAIChatGPT({\n    openAiApiKey: process.env.OPENAI_API_KEY as string,\n    model: 'gpt-5-nano',\n    extraRequestBodyParameters: {\n      temperature: 0.7\n    }\n  }),\n  fillPlainFields: {\n    'full_name_en': 'Translate this name to English: {{users_full_name}}',\n  },\n}),\n"})}),"\n",(0,i.jsx)(n.h2,{id:"image-to-text-analysis-vision",children:"Image-to-Text Analysis (Vision)"}),"\n",(0,i.jsx)(n.p,{children:"Analyze images and extract information to fill text, number, enum, or boolean fields."}),"\n",(0,i.jsx)(n.h3,{id:"example-age-detection-from-photos",children:"Example: Age Detection from Photos"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"import AdminForthImageVisionAdapterOpenAi from '@adminforth/image-vision-adapter-openai/index.js';\n\n// Add to your resource plugins array\nnew BulkAiFlowPlugin({\n  actionName: 'Guess age',\n  visionAdapter: new AdminForthImageVisionAdapterOpenAi({\n    openAiApiKey: process.env.OPENAI_API_KEY as string,\n    model: 'gpt-5-mini',\n  }),\n  fillFieldsFromImages: { \n    'age': 'Analyze the image and estimate the age of the person. Return only a number.',\n  },\n  attachFiles: async ({ record }) => {\n    if (!record.image_url) {\n      return [];\n    }\n    return [`https://users-images.s3.eu-north-1.amazonaws.com/${record.image_url}`];\n  },\n}),\n"})}),"\n",(0,i.jsx)(n.h2,{id:"text-to-image-generation-or-image-editing",children:"Text-to-Image generation or image editing"}),"\n",(0,i.jsx)(n.p,{children:"Generate new images based on existing data and/or images using AI image generation adapters."}),"\n",(0,i.jsx)(n.h3,{id:"example-creating-cartoon-avatars",children:"Example: Creating Cartoon Avatars"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"import ImageGenerationAdapterOpenAI from '@adminforth/image-generation-adapter-openai/index.js';\n\n// Add to your resource plugins array\nnew BulkAiFlowPlugin({\n  actionName: 'Generate cartoon avatars',\n  imageGenerationAdapter: new ImageGenerationAdapterOpenAI({\n    openAiApiKey: process.env.OPENAI_API_KEY as string,\n    model: 'gpt-image-1.5',\n  }),\n  attachFiles: async ({ record }) => {\n    if (!record.user_photo) {\n      return [];\n    }\n    return [`https://bulk-ai-flow-playground.s3.eu-north-1.amazonaws.com/${record.users_photo}`];\n  },\n  generateImages: {\n    users_avatar: {\n      prompt: 'Transform this photo into a cartoon-style avatar. Maintain the person\\'s features but apply cartoon styling. Do not add text or logos.',\n      outputSize: '1024x1024',\n      countToGenerate: 2,\n      rateLimit: '3/1h'\n    },\n  },\n  bulkGenerationRateLimit: \"1/1h\"\n}),\n"})}),"\n",(0,i.jsx)(n.h2,{id:"rate-limiting-and-best-practices",children:"Rate Limiting and Best Practices"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"rateLimit"})," for individual image generation operations and for the bulk image generation"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:'  new BulkAiFlowPlugin({\n  ...\n\n  generateImages: {\n    users_avatar: {\n      ... //image re-generation limits\n      //diff-add\n      rateLimit: \'1/5m\' // one request per 5 minutes\n    }\n  },\n\n  ...\n\n  //diff-add\n  rateLimits: { // bulk generation limits\n  //diff-add\n    fillFieldsFromImages: "5/1d", // 5 requests per day\n  //diff-add\n    fillPlainFields: "3/1h",      // 3 requests per one hour\n  //diff-add\n    generateImages: "1/2m",       // 2 request per one minute\n  //diff-add\n  }\n\n  ...\n\n  })\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Consider using lower resolution (",(0,i.jsx)(n.code,{children:"512x512"}),") for faster generation and lower costs"]}),"\n",(0,i.jsx)(n.li,{children:"Test prompts thoroughly before applying to large datasets"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"comparing-new-and-old-images",children:"Comparing new and old images"}),"\n",(0,i.jsx)(n.p,{children:"If you want to compare a generated image with an image stored in your storage, you need to add the preview prop in your upload plugin setup:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"  new UploadPlugin({\n        ...\n    //diff-add\n    preview: {\n    //diff-add\n      previewUrl: ({filePath}) => `https://static.my-domain.com/${filePath}`,\n    //diff-add\n    }\n        ...\n  })\n"})}),"\n",(0,i.jsx)(n.p,{children:'After generation, you\u2019ll see a button labeled "old image". Clicking it will open a pop-up where you can compare the generated image with the stored one:'}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"alt text",src:a(43081).A+"",width:"1732",height:"703"})}),"\n",(0,i.jsx)(n.h2,{id:"extra-data-fields",children:"Extra data fields"}),"\n",(0,i.jsx)(n.p,{children:"When creating default prompts, you can use Handlebars to pass data from the record into the prompt:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"  ...\n  fillPlainFields: { \n    description: 'Create a description based on the apartment name: {{title}}.'\n  },\n  ...\n"})}),"\n",(0,i.jsx)(n.p,{children:"Each record will receive a unique prompt based on its own title."}),"\n",(0,i.jsxs)(n.p,{children:["If you want to add extra data fields for use in your prompt, implement the ",(0,i.jsx)(n.code,{children:"provideAdditionalContextForRecord"})," callback:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"provideAdditionalContextForRecord({ record, adminUser, resource }) {\n  const extraData: any = {};\n  if (record.country === 'Spain') {\n    // Your logic\n    // e.g. extraData.discount = '10%';\n  } else {\n    // Your logic\n  }\n  return extraData;\n},\nfillPlainFields: { \n  description: 'Create a description based on the apartment name: {{title}}. Also include the fact that the apartment has a discount of {{extraData.discount}}.'\n},\n"})}),"\n",(0,i.jsx)(n.h2,{id:"allow-users-to-edit-generation-prompts",children:"Allow users to edit generation prompts"}),"\n",(0,i.jsx)(n.p,{children:"If you want to let users adjust generation prompts for their unique cases, add this to the plugin setup:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"...\n//diff-add\naskConfirmationBeforeGenerating: true,\n...\n"})}),"\n",(0,i.jsx)(n.p,{children:'The user will now see a popup with a "Start generation" button and an "Edit prompts" button, allowing them to modify the prompt before running it.'}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{alt:"alt text",src:a(18880).A+"",width:"1056",height:"673"}),"\n",(0,i.jsx)(n.img,{alt:"alt text",src:a(16443).A+"",width:"1100",height:"1024"})]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"\u261d\ufe0f Updated prompts are stored in the user's local storage. Changes are local to that browser and do not affect other users or devices."}),"\n"]})]})}function m(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},61636:(e,n,a)=>{a.d(n,{A:()=>i});const i=a.p+"assets/images/Bulk-vision-1-166513132e454cea427469361856fb27.png"},46911:(e,n,a)=>{a.d(n,{A:()=>i});const i=a.p+"assets/images/Bulk-vision-2-0e695786d4dfac65fec730c6a3aa8d8d.png"},93110:(e,n,a)=>{a.d(n,{A:()=>i});const i=a.p+"assets/images/Bulk-vision-3-034f3705373d52b1b3a3ec20828b7b48.png"},43081:(e,n,a)=>{a.d(n,{A:()=>i});const i=a.p+"assets/images/Bulk-vision-4-103f55319a1a88d58daf21850801190f.png"},18880:(e,n,a)=>{a.d(n,{A:()=>i});const i=a.p+"assets/images/Bulk-vision-5-b7a450ada9f67d82c97d40b6bfe83755.png"},16443:(e,n,a)=>{a.d(n,{A:()=>i});const i=a.p+"assets/images/Bulk-vision-6-f93cf60f35f0ba6ca1959c5ee94d0b96.png"},28453:(e,n,a)=>{a.d(n,{R:()=>s,x:()=>o});var i=a(96540);const t={},r=i.createContext(t);function s(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);