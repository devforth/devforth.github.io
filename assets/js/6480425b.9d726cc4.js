"use strict";(self.webpackChunkadminforth=self.webpackChunkadminforth||[]).push([[6190],{3627:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>r,toc:()=>c});var s=t(4848),o=t(8453);const i={},a="Custom bulk actions",r={id:"tutorial/Customization/bulkActions",title:"Custom bulk actions",description:"You might need to give admin users a feature to perform same action on multiple records at once.",source:"@site/docs/tutorial/03-Customization/09-bulkActions.md",sourceDirName:"tutorial/03-Customization",slug:"/tutorial/Customization/bulkActions",permalink:"/docs/tutorial/Customization/bulkActions",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:9,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Page Injections",permalink:"/docs/tutorial/Customization/pageInjections"},next:{title:"Menu Configuration",permalink:"/docs/tutorial/Customization/menuConfiguration"}},d={},c=[{value:"Limiting access to bulk actions",id:"limiting-access-to-bulk-actions",level:2}];function l(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",img:"img",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"custom-bulk-actions",children:"Custom bulk actions"}),"\n",(0,s.jsx)(n.p,{children:"You might need to give admin users a feature to perform same action on multiple records at once."}),"\n",(0,s.jsxs)(n.p,{children:["For example you might want allow setting ",(0,s.jsx)(n.code,{children:"listed"})," field to ",(0,s.jsx)(n.code,{children:"false"})," for multiple apartment records at once."]}),"\n",(0,s.jsx)(n.p,{children:"AdminForth by default provides a checkbox in first column of the list view for this purposes."}),"\n",(0,s.jsxs)(n.p,{children:["By default AdminForth provides only one bulk action ",(0,s.jsx)(n.code,{children:"delete"})," which allows to delete multiple records at once\n(if deletion for records available by ",(0,s.jsx)(n.a,{href:"/docs/api/types/Back/interfaces/ResourceOptions/#allowedactions",children:"resource.options.allowedActions"}),")"]}),"\n",(0,s.jsx)(n.p,{children:"To add custom bulk action quickly:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="./resources/apartments.ts"',children:"//diff-add\nimport { AdminUser } from 'adminforth';\n//diff-add\nimport { admin } from '../index';\n\n{\n  ...\n  resourceId: 'aparts',\n     ...\n     options: {\n//diff-add\n        bulkActions: [\n//diff-add\n          {\n//diff-add\n            label: 'Mark as listed',\n//diff-add\n            icon: 'flowbite:eye-solid',\n//diff-add\n            // if optional `confirm` is provided, user will be asked to confirm action\n//diff-add\n            confirm: 'Are you sure you want to mark all selected apartments as listed?',\n//diff-add\n            action: function ({selectedIds, adminUser }: {selectedIds: any[], adminUser: AdminUser }) {\n//diff-add\n              const stmt = admin.resource('aparts').dataConnector.db.prepare(`UPDATE apartments SET listed = 1 WHERE id IN (${selectedIds.map(() => '?').join(',')})`);\n//diff-add\n              stmt.run(...selectedIds);\n//diff-add\n              return { ok: true, error: false, successMessage: `Marked ${selectedIds.length} apartments as listed` };\n//diff-add\n            },\n//diff-add\n          }\n//diff-add\n        ],\n//diff-add\n      }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"Action code is called on the server side only and allowed to only authorized users."}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\u261d\ufe0f AdminForth provides no way to update the data, it is your responsibility to manage the data by selectedIds. You can use any ORM system\nor write raw queries to update the data."}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["\u261d\ufe0f You can use ",(0,s.jsx)(n.code,{children:"adminUser"})," object to check whether user is allowed to perform bulk action"]}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["Action response can return optional ",(0,s.jsx)(n.code,{children:"successMessage"})," property which will be shown to user after action is performed. If this property is not provided, no messages will be shown to user."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Here is how it looks:\n",(0,s.jsx)(n.img,{alt:"alt text",src:t(3744).A+"",width:"3700",height:"2044"})]}),"\n",(0,s.jsx)(n.h2,{id:"limiting-access-to-bulk-actions",children:"Limiting access to bulk actions"}),"\n",(0,s.jsx)(n.p,{children:"You might want to allow only certain users to perform your custom bulk action."}),"\n",(0,s.jsxs)(n.p,{children:["To implement this limitation use ",(0,s.jsx)(n.code,{children:"allowed"}),":"]}),"\n",(0,s.jsx)(n.p,{children:"If you want to prohibit the use of bulk action for user, you can do it this way:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="./resources/apartments.ts"',children:"bulkActions: [\n  {\n    label: 'Mark as listed',\n    icon: 'flowbite:eye-solid',\n    state:'active',\n//diff-add\n    allowed: async ({ resource, adminUser, selectedIds }) => {\n//diff-add     \n      if (adminUser.dbUser.role !== 'superadmin') {\n//diff-add       \n        return false;\n//diff-add\n        } \n//diff-add       \n        return true;\n//diff-add       \n    },\n      // if optional `confirm` is provided, user will be asked to confirm action\n    confirm: 'Are you sure you want to mark all selected apartments as listed?',\n    action: function ({selectedIds, adminUser }: {selectedIds: any[], adminUser: AdminUser }, allow) {\n      const stmt = admin.resource('aparts').dataConnector.db.prepare(`UPDATE apartments SET listed = 1 WHERE id IN (${selectedIds.map(() => '?').join(',')}`);\n      stmt.run(...selectedIds);\n      return { ok: true, error: false, successMessage: `Marked ${selectedIds.length} apartments as listed` };\n    },\n  }\n],\n"})})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},3744:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/Custom bulk actions-d43f3c77538ddc5e33c6891692bec9b0.png"},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>r});var s=t(6540);const o={},i=s.createContext(o);function a(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);