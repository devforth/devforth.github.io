"use strict";(self.webpackChunkadminforth=self.webpackChunkadminforth||[]).push([[7942],{51008:(n,e,a)=>{a.r(e),a.d(e,{assets:()=>l,contentTitle:()=>d,default:()=>u,frontMatter:()=>i,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"tutorial/Plugins/many2many","title":"Many2Many","description":"This plugin lets you manage many-to-many relationships.","source":"@site/docs/tutorial/08-Plugins/22-many2many.md","sourceDirName":"tutorial/08-Plugins","slug":"/tutorial/Plugins/many2many","permalink":"/docs/tutorial/Plugins/many2many","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":22,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Clone row","permalink":"/docs/tutorial/Plugins/clone-row"},"next":{"title":"Plugin development guide","permalink":"/docs/tutorial/Advanced/plugin-development"}}');var r=a(74848),s=a(28453);const i={},d="Many2Many",l={},o=[{value:"Installation",id:"installation",level:2},{value:"Setting up",id:"setting-up",level:2},{value:"Disable automatic cleanup of the junction table",id:"disable-automatic-cleanup-of-the-junction-table",level:2},{value:"Making editable fields for the both resources",id:"making-editable-fields-for-the-both-resources",level:2}];function c(n){const e={code:"code",h1:"h1",h2:"h2",header:"header",img:"img",p:"p",pre:"pre",...(0,s.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"many2many",children:"Many2Many"})}),"\n",(0,r.jsx)(e.p,{children:"This plugin lets you manage many-to-many relationships."}),"\n",(0,r.jsx)(e.h2,{id:"installation",children:"Installation"}),"\n",(0,r.jsx)(e.p,{children:"Install the plugin:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"npm i @adminforth/many2many\n"})}),"\n",(0,r.jsx)(e.h2,{id:"setting-up",children:"Setting up"}),"\n",(0,r.jsx)(e.p,{children:"Let's say we want to implement a relationship where every apartment can have many realtors and each realtor can have many apartments.\nWe'll also need a junction resource to connect realtors and apartments."}),"\n",(0,r.jsxs)(e.p,{children:["First, create the ",(0,r.jsx)(e.code,{children:"realtors"})," table and the junction table ",(0,r.jsx)(e.code,{children:"realtorsAparts"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-ts",metastring:'title="./schema.prisma"',children:"//diff-add\nmodel realtors {\n  //diff-add\n  id            String @id\n  //diff-add\n  name          String\n  //diff-add\n  surname       String\n  //diff-add\n}\n//diff-add\nmodel realtorsAparts {\n  //diff-add\n  id            String @id\n  //diff-add\n  realtorId     String\n  //diff-add\n  apartmentId   String\n  //diff-add\n}\n"})}),"\n",(0,r.jsx)(e.p,{children:"Migrate the Prisma schema:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"npm run makemigration -- --name add-realtors-and-realtorsAparts; npm run migrate:local\n"})}),"\n",(0,r.jsx)(e.p,{children:"Now create a resource for the realtors:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-ts",metastring:'title="./resources/realtors.ts"',children:"import { AdminForthDataTypes, AdminForthResourceInput } from 'adminforth';\n\nexport default {\n  dataSource: 'maindb',\n  table: 'realtors',\n  resourceId: 'realtors', \n  label: 'Realtors',\n  recordLabel: (r) => ` ${r.name}`,\n  columns: [\n    {\n      name: 'id',\n      type: AdminForthDataTypes.STRING,\n      label: 'Identifier',\n      showIn: {\n        list: false,\n        edit: false,\n        create: false,\n      },\n      primaryKey: true,\n      fillOnCreate: ({ initialRecord, adminUser }) => Math.random().toString(36).substring(7),\n    },\n    {\n      name: 'name',\n      required: true,\n      showIn: { all: true },\n      type: AdminForthDataTypes.STRING,\n      maxLength: 255,\n      minLength: 3,\n    },\n    {\n      name: \"surname\",\n      required: true,\n      showIn: { all: true },\n      type: AdminForthDataTypes.STRING,\n      maxLength: 100,\n      minLength: 3,\n    }\n  ],\n  options: {\n    listPageSize: 12,\n    allowedActions: {\n      edit: true,\n      delete: true,\n      show: true,\n      filter: true,\n    },\n  },\n} as AdminForthResourceInput;\n"})}),"\n",(0,r.jsxs)(e.p,{children:["And one for the junction table ",(0,r.jsx)(e.code,{children:"realtorsAparts"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-ts",metastring:'title="./resources/realtorsAparts.ts"',children:"import { AdminForthDataTypes, AdminForthResourceInput } from 'adminforth';\n\nexport default {\n  dataSource: 'maindb',\n  table: 'realtorsAparts',\n  resourceId: 'realtorsAparts', \n  label: 'Realtors-aparts',\n  columns: [\n    {\n      name: 'id',\n      type: AdminForthDataTypes.STRING,\n      label: 'Identifier',\n      showIn: {\n        list: false,\n        edit: false,\n        create: false,\n      },\n      primaryKey: true,\n      fillOnCreate: ({ initialRecord, adminUser }) => Math.random().toString(36).substring(7),\n    },\n    {\n      name: 'realtorId',\n      foreignResource: { \n        resourceId: 'realtors', \n        searchableFields: ['name'], \n        searchIsCaseSensitive: true \n      }\n    },\n    {\n      name: 'apartmentId',\n      foreignResource: { \n        resourceId: 'aparts',\n        searchableFields: ['title'],\n        searchIsCaseSensitive: true \n      }\n    },\n  ],\n  options: {\n    listPageSize: 12,\n    allowedActions: {\n      edit: true,\n      delete: true,\n      show: true,\n      filter: true,\n    },\n  },\n} as AdminForthResourceInput;\n"})}),"\n",(0,r.jsx)(e.p,{children:"Now add the plugin resources to the main config file:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-ts",metastring:'title="./index.ts"',children:"\n//diff-add \nimport realtorsResource from './resources/realtors.js';\n//diff-add \nimport realtorsApartsResource from './resources/realtorsAparts.js';\n\n  ...\n\n\ndataSources: [\n    {\n      id: 'maindb',\n      url: `${process.env.DATABASE_URL}`\n    },\n  ],\n  resources: [\n    ...\n    //diff-add\n    realtorsResource,\n    //diff-add\n    realtorsApartsResource\n  ]\n\n  ...\n\n  menu: [\n\n    ...\n    //diff-add\n    {\n      //diff-add\n      label: 'Realtors',\n      //diff-add\n      resourceId: 'realtors'\n      //diff-add\n    },\n    //diff-add\n    {\n      //diff-add\n      label: 'Realtors-aparts',\n      //diff-add\n      resourceId: 'realtorsAparts'\n      //diff-add\n    },\n\n    ...\n\n  ]\n\n"})}),"\n",(0,r.jsxs)(e.p,{children:["Finally, add the plugin to the ",(0,r.jsx)(e.code,{children:"apartments"})," resource:"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-ts",metastring:'title="./resources/apartments.ts"',children:"//diff-add\nimport Many2ManyPlugin from '@adminforth/many2many';\n\n  ...\n\n  plugins: [\n    ...\n\n    //diff-add\n    new Many2ManyPlugin({\n      //diff-add\n      linkedResourceId: 'realtors',\n      //diff-add\n    })\n\n    ...\n  ]\n\n  ...\n\n"})}),"\n",(0,r.jsxs)(e.p,{children:["The plugin is set up. Create some records in the ",(0,r.jsx)(e.code,{children:"realtors"})," table:\n",(0,r.jsx)(e.img,{alt:"alt text",src:a(48980).A+"",width:"1152",height:"444"}),"\nNow, when creating an apartment, you can select (link) one or more realtors.\n",(0,r.jsx)(e.img,{alt:"alt text",src:a(71439).A+"",width:"1154",height:"1154"}),"\nAfter saving the record, rows in the junction table are created automatically:\n",(0,r.jsx)(e.img,{alt:"alt text",src:a(80313).A+"",width:"1154",height:"530"})]}),"\n",(0,r.jsx)(e.h2,{id:"disable-automatic-cleanup-of-the-junction-table",children:"Disable automatic cleanup of the junction table"}),"\n",(0,r.jsx)(e.p,{children:"By default, when you delete a realtor or an apartment, all related rows in the junction table are deleted automatically. To avoid this behavior, add:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-ts",children:"\n  ...\n\n    new Many2ManyPlugin({\n      linkedResourceId: 'realtors',\n      //diff-add\n      dontDeleteJunctionRecords: true, // prevents automatic deletion of related junction rows\n    })\n\n  ...\n\n"})}),"\n",(0,r.jsx)(e.h2,{id:"making-editable-fields-for-the-both-resources",children:"Making editable fields for the both resources"}),"\n",(0,r.jsx)(e.p,{children:"There might be cases, when you want to make fields editable on both resources. For these cases you can just create second instance of plugin on the second resource and it will allow you to use this plugin from the both resources."}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-ts",metastring:'title="./resources/apartments.ts"',children:"//diff-add\nimport Many2ManyPlugin from '@adminforth/many2many';\n\n  ...\n\n  plugins: [\n    ...\n\n    //diff-add\n    new Many2ManyPlugin({\n      //diff-add\n      linkedResourceId: 'realtors',\n      //diff-add\n    })\n\n    ...\n  ]\n\n  ...\n\n"})}),"\n",(0,r.jsx)(e.p,{children:"and"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-ts",metastring:'title="./resources/realtors.ts"',children:"//diff-add\nimport Many2ManyPlugin from '@adminforth/many2many';\n\n  ...\n\n  plugins: [\n    ...\n\n    //diff-add\n    new Many2ManyPlugin({\n      //diff-add\n      linkedResourceId: 'aparts',\n      //diff-add\n    })\n\n    ...\n  ]\n\n  ...\n\n"})})]})}function u(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(c,{...n})}):c(n)}},48980:(n,e,a)=>{a.d(e,{A:()=>t});const t=a.p+"assets/images/Many2Many-1-065babec001887cf94ae83fc0ee84071.png"},71439:(n,e,a)=>{a.d(e,{A:()=>t});const t=a.p+"assets/images/Many2Many-2-af18bf59fa99313e7045aa480bccb2e3.png"},80313:(n,e,a)=>{a.d(e,{A:()=>t});const t=a.p+"assets/images/Many2Many-3-5b3200822a0f9162c32153cab8ac942e.png"},28453:(n,e,a)=>{a.d(e,{R:()=>i,x:()=>d});var t=a(96540);const r={},s=t.createContext(r);function i(n){const e=t.useContext(s);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:i(n.components),t.createElement(s.Provider,{value:e},n.children)}}}]);