"use strict";(self.webpackChunkadminforth=self.webpackChunkadminforth||[]).push([[1768],{9706:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>c,contentTitle:()=>s,default:()=>u,frontMatter:()=>r,metadata:()=>i,toc:()=>l});var o=t(4848),a=t(8453);const r={},s="Page Injections",i={id:"tutorial/Customization/pageInjections",title:"Page Injections",description:"In addition to ability to create custom pages and overwrite how fields are rendered, you can also inject custom components in standard AdminForth page.",source:"@site/docs/tutorial/03-Customization/08-pageInjections.md",sourceDirName:"tutorial/03-Customization",slug:"/tutorial/Customization/pageInjections",permalink:"/docs/tutorial/Customization/pageInjections",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:8,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Alerts and confirmations",permalink:"/docs/tutorial/Customization/alert"},next:{title:"Custom bulk actions",permalink:"/docs/tutorial/Customization/bulkActions"}},c={},l=[];function d(n){const e={blockquote:"blockquote",code:"code",h1:"h1",p:"p",pre:"pre",...(0,a.R)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.h1,{id:"page-injections",children:"Page Injections"}),"\n",(0,o.jsx)(e.p,{children:"In addition to ability to create custom pages and overwrite how fields are rendered, you can also inject custom components in standard AdminForth page."}),"\n",(0,o.jsxs)(e.p,{children:["For example let's add a custom pie chart to the ",(0,o.jsx)(e.code,{children:"list"})," page of the ",(0,o.jsx)(e.code,{children:"aparts"})," resource. Pie chart will show the distribution of the rooms count and more over will allow to filter the list by the rooms count."]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-diff",metastring:'title="/index.ts"',children:"{\n  resourceId: 'aparts',\n  ...\n+  options: {\n+    pageInjections: {\n+      list: {\n+        afterBreadcrumbs: '@@/ApartsPie.vue',\n+      }\n+    }\n+  }\n}\n"})}),"\n",(0,o.jsxs)(e.p,{children:["Now create file ",(0,o.jsx)(e.code,{children:"ApartsPie.vue"})," in the ",(0,o.jsx)(e.code,{children:"custom"})," folder of your project:"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-html",metastring:'title="/custom/ApartsPie.vue"',children:'<template>\n  <div class="max-w-sm w-full bg-white rounded-lg shadow dark:bg-gray-800 p-4 md:p-6 mb-5">\n    <div id="pie-chart"></div>\n  </div>\n</template>\n\n<script setup lang="ts">\nimport { onMounted, ref, Ref } from \'vue\';\nimport ApexCharts from \'apexcharts\';\n\nconst data: Ref<any[]> = ref([]);\n\nconst POSSIBLE_COLORS = ["#1C64F2", "#16BDCA", "#9061F9", "#F0A936", "#F55252", "#3B82F6", "#10B981", "#F472B6", "#6B7280"];\n\nconst chatOptions = {\n  series: [52.8, 26.8, 20.4],\n  colors: POSSIBLE_COLORS,\n  chart: {\n    height: 420,\n    width: "100%",\n    type: "pie",\n    events: {\n      dataPointSelection: function (event, chartContext, config) {\n        const selectedRoomsCount = data.value[config.dataPointIndex].rooms;\n        window.adminforth.updateListFilter({field: \'number_of_rooms\', operator: \'eq\', value: selectedRoomsCount});\n      }\n    },\n  },\n\n  stroke: {\n    colors: ["white"],\n    lineCap: "",\n  },\n  plotOptions: {\n    pie: {\n      labels: {\n        show: true,\n      },\n      size: "100%",\n      dataLabels: {\n        offset: -25\n      }\n    },\n  },\n  labels: ["Direct", "Organic search", "Referrals"],\n  dataLabels: {\n    enabled: true,\n    style: {\n      fontFamily: "Inter, sans-serif",\n    },\n  },\n  legend: {\n    position: "right",\n    fontFamily: "Inter, sans-serif",\n  },\n  yaxis: {\n    labels: {\n      formatter: function (value) {\n        return value + "%"\n      },\n    },\n  },\n  xaxis: {\n    labels: {\n      formatter: function (value) {\n        return value  + "%"\n      },\n    },\n    axisTicks: {\n      show: false,\n    },\n    axisBorder: {\n      show: false,\n    },\n  }, \n}\n\n\nonMounted(async () => {\n  try {\n    const resp = await fetch(\'/api/aparts-by-room-percentages\');\n    if (resp.status === 401) {\n      // user will be redirected to login page automatically so no need to handle anything here\n      return;\n    }\n    data.value = await resp.json();\n  } catch (error) {\n    window.adminforth.alert({\n      message: `Error fetching data: ${error.message}`,\n      variant: \'danger\',\n      timeout: \'unlimited\'\n    });\n    return;\n  }\n\n  chatOptions.series = data.value.map((item) => item.percentage);\n  chatOptions.labels = data.value.map((item) => `${item.rooms} rooms`);\n  const chart = new ApexCharts(document.getElementById("pie-chart"), chatOptions);\n  chart.render();\n\n})\n\n<\/script>\n'})}),"\n",(0,o.jsx)(e.p,{children:"Also we have to add an Api to get percentages:"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",metastring:'title="/index.ts"',children:"  app.get('/api/aparts-by-room-percentages/',\n    admin.express.authorize(\n      async (req, res) => {\n        const roomPercentages = await db.prepare(\n          `SELECT \n            number_of_rooms, \n            COUNT(*) as count \n          FROM apartments \n          GROUP BY number_of_rooms\n          ORDER BY number_of_rooms;\n          `\n        ).all();\n\n        const totalAparts = roomPercentages.reduce((acc, { count }) => acc + count, 0);\n\n        res.json(\n          roomPercentages.map(\n            ({ number_of_rooms, count }) => ({\n              rooms: number_of_rooms,\n              percentage: Math.round(count / totalAparts * 100),\n            })\n          )\n        );\n      }\n    )\n  );\n\n  // serve after you added all api\n  admin.discoverDatabases();\n  admin.express.serve(app)\n"})}),"\n",(0,o.jsxs)(e.blockquote,{children:["\n",(0,o.jsxs)(e.p,{children:["\ud83e\udee8 Please note that we are using ",(0,o.jsx)(e.code,{children:"window.adminforth.updateListFilter({field: 'number_of_rooms', operator: 'eq', value: selectedRoomsCount});"})," to set filter when we are located on apartments list page"]}),"\n"]}),"\n",(0,o.jsx)(e.p,{children:"< screenshot >"})]})}function u(n={}){const{wrapper:e}={...(0,a.R)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(d,{...n})}):d(n)}},8453:(n,e,t)=>{t.d(e,{R:()=>s,x:()=>i});var o=t(6540);const a={},r=o.createContext(a);function s(n){const e=o.useContext(r);return o.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function i(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(a):n.components||a:s(n.components),o.createElement(r.Provider,{value:e},n.children)}}}]);