"use strict";(self.webpackChunkadminforth=self.webpackChunkadminforth||[]).push([[9529],{83581:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"tutorial/Customization/dataApi","title":"Data API","description":"AdminForth Data API is a minimal set of methods to manipulate the data in the database.","source":"@site/docs/tutorial/03-Customization/11-dataApi.md","sourceDirName":"tutorial/03-Customization","slug":"/tutorial/Customization/dataApi","permalink":"/docs/tutorial/Customization/dataApi","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":11,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Menu Configuration","permalink":"/docs/tutorial/Customization/menuConfiguration"},"next":{"title":"Security","permalink":"/docs/tutorial/Customization/security"}}');var s=t(74848),r=t(28453);const i={},o="Data API",d={},l=[{value:"Motivation",id:"motivation",level:2},{value:"Usage",id:"usage",level:2},{value:"Get one item from database",id:"get-one-item-from-database",level:2},{value:"Get list of items from database",id:"get-list-of-items-from-database",level:2},{value:"Create a new item in database",id:"create-a-new-item-in-database",level:2},{value:"Count items in database",id:"count-items-in-database",level:2},{value:"Update item in database",id:"update-item-in-database",level:2},{value:"Delete item from database",id:"delete-item-from-database",level:2},{value:"Performance considerations",id:"performance-considerations",level:2}];function c(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"data-api",children:"Data API"})}),"\n",(0,s.jsxs)(n.p,{children:["AdminForth Data API is a minimal set of methods to manipulate the data in the database.\nWith Data API you can make very basic operations like ",(0,s.jsx)(n.code,{children:"get"}),", ",(0,s.jsx)(n.code,{children:"list"}),", ",(0,s.jsx)(n.code,{children:"create"}),", ",(0,s.jsx)(n.code,{children:"update"}),", ",(0,s.jsx)(n.code,{children:"delete"}),", ",(0,s.jsx)(n.code,{children:"count"})," on the resources."]}),"\n",(0,s.jsx)(n.h2,{id:"motivation",children:"Motivation"}),"\n",(0,s.jsx)(n.p,{children:"Since AdminForth has internal DataSource Connectors with unified & secure interface to work with different databases, we decided\nwhy not to expose this interface to you."}),"\n",(0,s.jsx)(n.p,{children:"This allows you to make basic operations on the data with AdminForth without using 3rd party ORMs or writing manual SQL queries."}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\u261d\ufe0f For advanced operations like generating aggregations, joins and other complex queries you should use your own ORM or query builder."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,s.jsxs)(n.p,{children:["Basically you just import ",(0,s.jsx)(n.code,{children:"Filters"}),", ",(0,s.jsx)(n.code,{children:"Sorts"})," from the ",(0,s.jsx)(n.code,{children:"adminforth"})," package and call the awaitable methods on the ",(0,s.jsx)(n.code,{children:"admin.resource('adminuser')"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { Filters, Sorts } from 'adminforth';\n...\n\nconst admin = new AdminForth({\n  ...\n});\n\n// get the resource object\nawait admin.resource('adminuser').get(Filters.EQ('id', '1234'));\n"})}),"\n",(0,s.jsx)(n.p,{children:"Here we will show you how to use the Data API with simple examples."}),"\n",(0,s.jsx)(n.h2,{id:"get-one-item-from-database",children:"Get one item from database"}),"\n",(0,s.jsx)(n.p,{children:"Signature:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:".get(\n  filters: <AdminForthFilterObject>,\n): Promise<any>\n"})}),"\n",(0,s.jsx)(n.p,{children:"Get item by ID:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const user = await admin.resource('adminuser').get(\n  [Filters.EQ('id', '1234')]\n);\n"})}),"\n",(0,s.jsx)(n.p,{children:"Check School with name 'Hawkins Elementary' exits in DB"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const schoolExists = !!(await admin.resource('schools').get(\n  [Filters.EQ('name', 'Hawkins Elementary')]\n));\n"})}),"\n",(0,s.jsx)(n.p,{children:"Get user with name 'John' and role not 'SuperAdmin'"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const user = await admin.resource('adminuser').get(\n  Filters.EQ('name', 'John'), \n  Filters.NEQ('role', 'SuperAdmin')\n);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"get-list-of-items-from-database",children:"Get list of items from database"}),"\n",(0,s.jsx)(n.p,{children:"Signature:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:".list(\n  filters: <AdminForthFilterObject>,\n  limit: number | null\n  offset: number | null\n  sort: []\n): Promise<any[]>\n"})}),"\n",(0,s.jsx)(n.p,{children:"Get 15 latest users which role is not Admin:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const users = await admin.resource('adminuser').list(\n  [Filters.NEQ('role', 'Admin')], 15, 0, Sorts.DESC('createdAt')\n);\n"})}),"\n",(0,s.jsx)(n.p,{children:"Get 10 oldest users (with highest age):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const users = await admin.resource('adminuser').list([], 10, 0, Sorts.ASC('age'));\n"})}),"\n",(0,s.jsx)(n.p,{children:"Get next page of oldest users:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const users = await admin.resource('adminuser').list([], 10, 10, Sorts.ASC('age'));\n"})}),"\n",(0,s.jsx)(n.p,{children:"Get 10 schools, sort by rating first, then oldest by founded year:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const schools = await admin.resource('schools').list(\n  [], 10, 0, [Sorts.DESC('rating'), Sorts.ASC('foundedYear')]\n);\n"})}),"\n",(0,s.jsx)(n.p,{children:"Get all users that have gmail address AND the ones created not in 2024"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const users = await admin.resource('adminuser').list(\n  Filters.AND(\n    Filters.LIKE('email', '@gmail.com'),\n    Filters.OR(\n      Filters.LT('createdAt', '2024-01-01T00:00:00.000Z'),\n      Filters.GTE('createdAt', '2025-01-01T00:00:00.000Z'),\n    ),\n  )\n);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"create-a-new-item-in-database",children:"Create a new item in database"}),"\n",(0,s.jsx)(n.p,{children:"Signature:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:".create({\n  <resource fields>\n}): Promise<any>\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Returns value representing created item with all fields, including fields which were populated with ",(0,s.jsx)(n.code,{children:"fillOnCreate"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"Create a new school:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"await admin.resource('schools').create({\n  name: 'Hawkins Elementary',\n  rating: 5,\n  foundedYear: 1950,\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"count-items-in-database",children:"Count items in database"}),"\n",(0,s.jsx)(n.p,{children:"Signature:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:".count(\n  filters: <AdminForthFilterObject>,\n): Promise<any>\n"})}),"\n",(0,s.jsx)(n.p,{children:"Returns number of items in database which match the filters."}),"\n",(0,s.jsx)(n.p,{children:"Count number of schools with rating above 4:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const schoolsCount = await admin.resource('schools').count(Filters.GT('rating', 4));\n"})}),"\n",(0,s.jsx)(n.p,{children:"Create data for daily report with number of users signed up daily for last 7 days:"}),"\n",(0,s.jsxs)(n.p,{children:["Note: while this is not the most efficient way to do this, it's a good example of how you can use ",(0,s.jsx)(n.code,{children:"count"})," method to get the data for the report.\nPlus it still should be fast enough while you have index on ",(0,s.jsx)(n.code,{children:"createdAt"})," field."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const dailyReports = await Promise.all(\n  Array.from({ length: 7 }, (_, i) => {\n    const dateStart = new Date();\n    dateStart.setDate(dateStart.getDate() - i);\n    dateStart.setHours(0, 0, 0, 0);\n    const dateEnd = new Date(dateStart);\n    dateEnd.setDate(dateEnd.getDate() + 1);\n\n    return admin.resource('adminuser').count(\n      [Filters.GTE('createdAt', dateStart.toISOString()), Filters.LT('createdAt', dateEnd.toISOString())]\n    );\n  })\n);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"update-item-in-database",children:"Update item in database"}),"\n",(0,s.jsx)(n.p,{children:"Signature:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:".update(\n  primaryKey: string, // value of field marked as primaryKey in resource configuration\n  {\n    <resource fields which you want to update>\n  }\n): Promise<any>\n"})}),"\n",(0,s.jsx)(n.p,{children:"Update school rating to 4.8"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"await admin.resource('schools').update('1234', { rating: 4.8 });\n"})}),"\n",(0,s.jsx)(n.h2,{id:"delete-item-from-database",children:"Delete item from database"}),"\n",(0,s.jsx)(n.p,{children:"Signature:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:".delete(\n  primaryKey: string, // value of field marked as primaryKey in resource configuration\n): Promise<boolean>\n"})}),"\n",(0,s.jsx)(n.p,{children:"Delete school with ID '1234'"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"await admin.resource('schools').delete('1234');\n"})}),"\n",(0,s.jsx)(n.h2,{id:"performance-considerations",children:"Performance considerations"}),"\n",(0,s.jsx)(n.p,{children:"Remember that AdminForth never creates an indexes on the database, so it is your responsibility to create them whether you need to speed up\nthe queries created from this Data API or to make AdminForth UI faster."}),"\n",(0,s.jsx)(n.p,{children:"On low data volumes you will not notice the difference in performance with or without indexes, but on high data volumes it might be very and  very crucial."}),"\n",(0,s.jsx)(n.p,{children:"Golden rule: create one index per query you are going to use often or where you see the performance issues."}),"\n",(0,s.jsx)(n.p,{children:"For example if you have two queries:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const users = await admin.resource('adminuser').list(\n  [Filters.NEQ('role', 'Admin')], 15, 0, Sorts.DESC('createdAt')\n);\nconst users = await admin.resource('adminuser').list(\n  [Filters.EQ('name', 'John'), Filters.NEQ('role', 'SuperAdmin')]\n);\n"})}),"\n",(0,s.jsx)(n.p,{children:"You have to create two different indexes:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE INDEX idx_users_role ON users(role, createdAt);\nCREATE INDEX idx_users_name_role ON users(name, role);\n"})}),"\n",(0,s.jsx)(n.p,{children:"Create INDEX is just for example, you have to use your migrator / ORM to create indexes in your database."}),"\n",(0,s.jsxs)(n.p,{children:["First one covers performance for the first query, second one for the second query.\nIf you did not understand how indexes are created: ",(0,s.jsx)(n.strong,{children:"get sorted tuple of all fields in filters + all fields in sort,\nin order they appear in filters and sort"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>o});var a=t(96540);const s={},r=a.createContext(s);function i(e){const n=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);