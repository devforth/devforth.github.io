"use strict";(self.webpackChunkadminforth=self.webpackChunkadminforth||[]).push([[3660],{87287:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"tutorial/Customization/Actions","title":"Actions","description":"Single record actions","source":"@site/docs/tutorial/03-Customization/09-Actions.md","sourceDirName":"tutorial/03-Customization","slug":"/tutorial/Customization/Actions","permalink":"/docs/tutorial/Customization/Actions","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":9,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Page Injections","permalink":"/docs/tutorial/Customization/pageInjections"},"next":{"title":"Menu Configuration","permalink":"/docs/tutorial/Customization/menuConfiguration"}}');var o=t(74848),i=t(28453);const a={},r="Actions",d={},c=[{value:"Single record actions",id:"single-record-actions",level:2},{value:"Action Configuration Options",id:"action-configuration-options",level:3},{value:"Access Control",id:"access-control",level:3},{value:"Action URL",id:"action-url",level:3},{value:"Custom bulk actions",id:"custom-bulk-actions",level:2},{value:"Limiting access to bulk actions",id:"limiting-access-to-bulk-actions",level:2},{value:"Custom Component",id:"custom-component",level:2},{value:"Pass dynamic values to the action",id:"pass-dynamic-values-to-the-action",level:3}];function l(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"actions",children:"Actions"})}),"\n",(0,o.jsx)(n.h2,{id:"single-record-actions",children:"Single record actions"}),"\n",(0,o.jsx)(n.p,{children:"You might need to give admin users a feature to perform some action on a single record. Actions can be displayed as buttons in the list view and/or in the three-dots menu."}),"\n",(0,o.jsx)(n.p,{children:"Here's how to add a custom action:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",metastring:'title="./resources/apartments.ts"',children:"{\n  resourceId: 'aparts',\n  options: {\n    actions: [\n      {\n        name: 'Auto submit',  // Display name of the action\n        icon: 'flowbite:play-solid',  // Icon to display (using Flowbite icons)\n        \n        // Control who can see/use this action\n        allowed: ({ adminUser, standardAllowedActions }) => {\n          return true;  // Allow everyone\n        },\n        \n        // Handler function when action is triggered\n        action: async ({ recordId, adminUser }) => {\n          console.log(\"auto submit\", recordId, adminUser);\n          return { \n            ok: true, \n            successMessage: \"Auto submitted\" \n          };\n        },\n\n        // Configure where the action appears\n        showIn: {\n          list: true,              // Show in list view\n          showButton: true,        // Show as a button\n          showThreeDotsMenu: true, // Show in three-dots menu\n        }\n      }\n    ]\n  }\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"action-configuration-options",children:"Action Configuration Options"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"name"}),": Display name of the action"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"icon"}),": Icon to show (using Flowbite icon set)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"allowed"}),": Function to control access to the action"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"action"}),": Handler function that executes when action is triggered"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"showIn"}),": Controls where the action appears","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"list"}),": whether to show in list view"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"showButton"}),": whether to show as a button on show view"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"showThreeDotsMenu"}),": when to show in the three-dots menu of show view"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"access-control",children:"Access Control"}),"\n",(0,o.jsxs)(n.p,{children:["You can control who can use an action through the ",(0,o.jsx)(n.code,{children:"allowed"})," function. This function receives:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",metastring:'title="./resources/apartments.ts"',children:"{\n  options: {\n    actions: [\n      {\n        name: 'Auto submit',\n        allowed: async ({ adminUser, standardAllowedActions }) => {\n          if (adminUser.dbUser.role !== 'superadmin') {\n            return false;\n          }\n          return true;\n        },\n        // ... other configuration\n      }\n    ]\n  }\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"allowed"})," function receives:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"adminUser"}),": The current admin user object"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"standardAllowedActions"}),": Standard permissions for the current user"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Return:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"true"})," to allow access"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"false"})," to deny access"]}),"\n",(0,o.jsx)(n.li,{children:"A string with an error message to explain why access was denied"}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Here is how it looks:\n",(0,o.jsx)(n.img,{alt:"alt text",src:t(70372).A+"",width:"2560",height:"1359"})]}),"\n",(0,o.jsx)(n.p,{children:"You might want to allow only certain users to perform your custom bulk action."}),"\n",(0,o.jsxs)(n.p,{children:["To implement this limitation use ",(0,o.jsx)(n.code,{children:"allowed"}),":"]}),"\n",(0,o.jsx)(n.p,{children:"If you want to prohibit the use of bulk action for user, you can do it this way:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",metastring:'title="./resources/apartments.ts"',children:"import { admin } from '../index';\n\n....\n\nbulkActions: [\n  {\n    label: 'Mark as listed',\n    icon: 'flowbite:eye-solid',\n    allowed: async ({ resource, adminUser, selectedIds }) => {\n      if (adminUser.dbUser.role !== 'superadmin') {\n        return false;\n      } \n      return true;\n    },\n    confirm: 'Are you sure you want to mark all selected apartments as listed?',\n    action: async ({ resource, selectedIds, adminUser, tr }) => {\n        const stmt = admin.resource('aparts').dataConnector.client.prepare(\n          `UPDATE apartments SET listed = 1 WHERE id IN (${selectedIds.map(() => '?').join(',')})`\n        );\n        await stmt.run(...selectedIds);\n\n        return { ok: true, message: tr(`Marked ${selectedIds.length} apartments as listed`) };\n    },\n  }\n],\n"})}),"\n",(0,o.jsx)(n.h3,{id:"action-url",children:"Action URL"}),"\n",(0,o.jsxs)(n.p,{children:["Instead of defining an ",(0,o.jsx)(n.code,{children:"action"})," handler, you can specify a ",(0,o.jsx)(n.code,{children:"url"})," that the user will be redirected to when clicking the action button:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",metastring:'title="./resources/apartments.ts"',children:"{\n  name: 'View details',\n  icon: 'flowbite:eye-solid',\n  url: '/resource/aparts',  // URL to redirect to\n  showIn: {\n    list: true,\n    showButton: true,\n    showThreeDotsMenu: true,\n  } \n}\n"})}),"\n",(0,o.jsx)(n.p,{children:"The URL can be:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"A relative path within your admin panel (starting with '/')"}),"\n",(0,o.jsx)(n.li,{children:"An absolute URL (starting with 'http://' or 'https://')"}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["To open the URL in a new tab, add ",(0,o.jsx)(n.code,{children:"?target=_blank"})," to the URL:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"{\n  name: 'View on Google',\n  icon: 'flowbite:external-link-solid',\n  url: 'https://google.com/search?q=apartment&target=_blank',\n  showIn: {\n    list: true,\n    showButton: true\n  }\n}\n"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["\u261d\ufe0f Note: You cannot specify both ",(0,o.jsx)(n.code,{children:"action"})," and ",(0,o.jsx)(n.code,{children:"url"})," for the same action - only one should be used."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"custom-bulk-actions",children:"Custom bulk actions"}),"\n",(0,o.jsx)(n.p,{children:"You might need to give admin users a feature to perform same action on multiple records at once."}),"\n",(0,o.jsxs)(n.p,{children:["For example you might want allow setting ",(0,o.jsx)(n.code,{children:"listed"})," field to ",(0,o.jsx)(n.code,{children:"false"})," for multiple apartment records at once."]}),"\n",(0,o.jsx)(n.p,{children:"AdminForth by default provides a checkbox in first column of the list view for this purposes."}),"\n",(0,o.jsxs)(n.p,{children:["By default AdminForth provides only one bulk action ",(0,o.jsx)(n.code,{children:"delete"})," which allows to delete multiple records at once\n(if deletion for records available by ",(0,o.jsx)(n.a,{href:"/docs/api/Back/interfaces/ResourceOptions/#allowedactions",children:"resource.options.allowedActions"}),")"]}),"\n",(0,o.jsx)(n.p,{children:"To add custom bulk action quickly:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",metastring:'title="./resources/apartments.ts"',children:"//diff-add\nimport { AdminUser } from 'adminforth';\n//diff-add\nimport { admin } from '../index';\n\n{\n  ...\n  resourceId: 'aparts',\n     ...\n     options: {\n//diff-add\n        bulkActions: [\n//diff-add\n          {\n//diff-add\n            label: 'Mark as listed',\n//diff-add\n            icon: 'flowbite:eye-solid',\n//diff-add\n            // if optional `confirm` is provided, user will be asked to confirm action\n//diff-add\n            confirm: 'Are you sure you want to mark all selected apartments as listed?',\n//diff-add\n            action: async function ({selectedIds, adminUser }: {selectedIds: any[], adminUser: AdminUser }) {\n//diff-add\n              const stmt = admin.resource('aparts').dataConnector.client.prepare(`UPDATE apartments SET listed = 1 WHERE id IN (${selectedIds.map(() => '?').join(',')})`);\n//diff-add\n              await stmt.run(...selectedIds);\n//diff-add\n              return { ok: true, error: false, successMessage: `Marked ${selectedIds.length} apartments as listed` };\n//diff-add\n            },\n//diff-add\n          }\n//diff-add\n        ],\n      }\n}\n"})}),"\n",(0,o.jsx)(n.p,{children:"Action code is called on the server side only and allowed to only authorized users."}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"\u261d\ufe0f AdminForth provides no way to update the data, it is your responsibility to manage the data by selectedIds. You can use any ORM system\nor write raw queries to update the data."}),"\n"]}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["\u261d\ufe0f You can use ",(0,o.jsx)(n.code,{children:"adminUser"})," object to check whether user is allowed to perform bulk action"]}),"\n"]}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["Action response can return optional ",(0,o.jsx)(n.code,{children:"successMessage"})," property which will be shown to user after action is performed. If this property is not provided, no messages will be shown to user."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Here is how it looks:\n",(0,o.jsx)(n.img,{alt:"alt text",src:t(65112).A+"",width:"3700",height:"2044"})]}),"\n",(0,o.jsx)(n.h2,{id:"limiting-access-to-bulk-actions",children:"Limiting access to bulk actions"}),"\n",(0,o.jsx)(n.p,{children:"You might want to allow only certain users to perform your custom bulk action."}),"\n",(0,o.jsxs)(n.p,{children:["To implement this limitation use ",(0,o.jsx)(n.code,{children:"allowed"}),":"]}),"\n",(0,o.jsx)(n.p,{children:"If you want to prohibit the use of bulk action for user, you can do it this way:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",metastring:'title="./resources/apartments.ts"',children:"bulkActions: [\n  {\n    label: 'Mark as listed',\n    icon: 'flowbite:eye-solid',\n//diff-add\n    allowed: async ({ resource, adminUser, selectedIds }) => {\n//diff-add     \n      if (adminUser.dbUser.role !== 'superadmin') {\n//diff-add       \n        return false;\n//diff-add\n        } \n//diff-add       \n        return true;\n//diff-add       \n    },\n      // if optional `confirm` is provided, user will be asked to confirm action\n    confirm: 'Are you sure you want to mark all selected apartments as listed?',\n    action: async function ({selectedIds, adminUser }: {selectedIds: any[], adminUser: AdminUser }, allow) {\n      const stmt = admin.resource('aparts').dataConnector.client.prepare(`UPDATE apartments SET listed = 1 WHERE id IN (${selectedIds.map(() => '?').join(',')}`);\n      await stmt.run(...selectedIds);\n      return { ok: true, error: false, successMessage: `Marked ${selectedIds.length} apartments as listed` };\n    },\n  }\n],\n"})}),"\n",(0,o.jsx)(n.h2,{id:"custom-component",children:"Custom Component"}),"\n",(0,o.jsxs)(n.p,{children:["If you want to style an action's button/icon without changing its behavior, attach a custom UI wrapper via ",(0,o.jsx)(n.code,{children:"customComponent"}),".\nThe file points to your SFC in the custom folder (alias ",(0,o.jsx)(n.code,{children:"@@/"}),"), and ",(0,o.jsx)(n.code,{children:"meta"})," lets you pass lightweight styling options (e.g., border color, radius)."]}),"\n",(0,o.jsxs)(n.p,{children:["Below we wrap a \u201cMark as listed\u201d action (see the original example in ",(0,o.jsx)(n.a,{href:"#custom-bulk-actions",children:"Custom bulk actions"}),")."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",metastring:'title="./resources/apartments.ts"',children:"{\n  resourceId: 'aparts',\n  options: {\n    actions: [\n      {\n        name: 'Mark as listed',\n        icon: 'flowbite:eye-solid',\n        // UI wrapper for the built-in action button\n        //diff-add\n        customComponent: {\n          //diff-add\n          file: '@@/ActionBorder.vue',        // SFC path in your custom folder\n          //diff-add\n          meta: { color: '#94a3b8', radius: 10 }\n          //diff-add\n        },\n        showIn: { list: true, showButton: true, showThreeDotsMenu: true },\n        action: async ({ recordId }) => {\n          await admin.resource('aparts').update(recordId, { listed: 1 });\n          return { ok: true, successMessage: 'Marked as listed' };\n        }\n      },\n    ]\n  }\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Use this minimal wrapper component to add a border/rounding around the default action UI while keeping the action logic intact.\nKeep the ",(0,o.jsx)(n.code,{children:"<slot />"})," (that's where AdminForth renders the default button) and emit ",(0,o.jsx)(n.code,{children:"callAction"})," (optionally with a payload) to trigger the handler when the wrapper is clicked."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",metastring:'title="./custom/ActionBorder.vue"',children:"<template>\n  \x3c!-- Keep the slot: AdminForth renders the default action button/icon here --\x3e\n  \x3c!-- Emit `callAction` (optionally with a payload) to trigger the action when the wrapper is clicked --\x3e\n  \x3c!-- Example: provide `meta.extra` to send custom data. In list views we merge with `row` so recordId context is kept. --\x3e\n  <div :style=\"styleObj\" @click=\"emit('callAction', { ...props.row, ...(props.meta?.extra ?? {}) })\">\n    <slot />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue';\n\nconst props = defineProps<{\n  // meta can style the wrapper and optionally carry extra payload for the action\n  meta?: { color?: string; radius?: number; padding?: number; extra?: any };\n  // When used in list view, the table passes current row\n  row?: any;\n  // When used in show/edit views, the page passes current record\n  record?: any;\n}>();\nconst emit = defineEmits<{ (e: 'callAction', payload?: any): void }>();\n\nconst styleObj = computed(() => ({\n  display: 'inline-block',\n  border: `1px solid ${props.meta?.color ?? '#e5e7eb'}`,\n  borderRadius: (props.meta?.radius ?? 8) + 'px',\n  padding: (props.meta?.padding ?? 2) + 'px',\n}));\n<\/script>\n"})}),"\n",(0,o.jsx)(n.h3,{id:"pass-dynamic-values-to-the-action",children:"Pass dynamic values to the action"}),"\n",(0,o.jsxs)(n.p,{children:["You can pass arbitrary data from your custom UI wrapper to the backend action by emitting ",(0,o.jsx)(n.code,{children:"callAction"})," with a payload. That payload will be available on the server under the ",(0,o.jsx)(n.code,{children:"extra"})," argument of your action handler."]}),"\n",(0,o.jsx)(n.p,{children:"Frontend examples:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-vue",metastring:'title="./custom/ActionToggleListed.vue"',children:'<template>\n  \x3c!-- Two buttons that pass different flags to the action --\x3e\n  <button @click="emit(\'callAction\', { asListed: true })" class="mr-2">Mark as listed</button>\n  <button @click="emit(\'callAction\', { asListed: false })">Mark as unlisted</button>\n\n  \x3c!-- Or keep the default slot button and wrap it: --\x3e\n  <div @click="emit(\'callAction\', { asListed: true })">\n    <slot />\n  </div>\n</template>\n\n<script setup lang="ts">\nconst emit = defineEmits<{ (e: \'callAction\', payload?: any): void }>();\n<\/script>\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Backend handler: read the payload via ",(0,o.jsx)(n.code,{children:"extra"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",metastring:'title="./resources/apartments.ts"',children:"{\n  resourceId: 'aparts',\n  options: {\n    actions: [\n      {\n        name: 'Toggle listed',\n        icon: 'flowbite:eye-solid',\n        showIn: { list: false, showButton: true, showThreeDotsMenu: true },\n        // The payload from emit('callAction', { asListed: true|false }) arrives here as `extra`\n        customComponent: {\n          file: '@@/ActionToggleListed.vue'\n        },\n        action: async ({ recordId, extra }) => {\n          const asListed = extra?.asListed === true;\n          // Example update (use your own data layer):\n          await admin.resource('aparts').update(recordId, { listed: asListed });\n          return { ok: true, successMessage: `Set listed=${asListed}` };\n        }\n      }\n    ]\n  }\n}\n"})}),"\n",(0,o.jsx)(n.p,{children:"Notes:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["If you don\u2019t emit a payload, the default behavior is used by the UI (e.g., in lists the current row context is used). When you do provide a payload, it will be forwarded to the backend as ",(0,o.jsx)(n.code,{children:"extra"})," for your action handler."]}),"\n",(0,o.jsxs)(n.li,{children:["You can combine default context with your own payload by merging before emitting, for example: ",(0,o.jsx)(n.code,{children:"emit('callAction', { ...row, asListed: true })"})," if your component has access to the row object."]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},65112:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/Custom bulk actions-d43f3c77538ddc5e33c6891692bec9b0.png"},70372:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/Single record actions-61017c801a3d439a83ad101bb3c20469.png"},28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>r});var s=t(96540);const o={},i=s.createContext(o);function a(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);