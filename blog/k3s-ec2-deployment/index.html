<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">IaC Simplified: K3s on EC2 Deployments with Terraform, Helm, Ansible &amp; Amazon ECR | Vue &amp; Node admin panel framework</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://adminforth.dev/img/og.jpg"><meta data-rh="true" name="twitter:image" content="https://adminforth.dev/img/og.jpg"><meta data-rh="true" property="og:url" content="https://adminforth.dev/blog/k3s-ec2-deployment/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="IaC Simplified: K3s on EC2 Deployments with Terraform, Helm, Ansible &amp; Amazon ECR | Vue &amp; Node admin panel framework"><meta data-rh="true" name="description" content="The ultimate step-by-step guide to cost-effective, build-time-efficient, and easy managable EC2 deployments using K3s, Terraform, Helm, Ansible, and a Amazon ECR registry."><meta data-rh="true" property="og:description" content="The ultimate step-by-step guide to cost-effective, build-time-efficient, and easy managable EC2 deployments using K3s, Terraform, Helm, Ansible, and a Amazon ECR registry."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2025-11-04T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/kirilldorr"><meta data-rh="true" property="article:tag" content="AWS,Terraform,Helm,k3s,Ansible"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://adminforth.dev/blog/k3s-ec2-deployment/"><link data-rh="true" rel="alternate" href="https://adminforth.dev/blog/k3s-ec2-deployment/" hreflang="en"><link data-rh="true" rel="alternate" href="https://adminforth.dev/blog/k3s-ec2-deployment/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://VSIPOF54AV-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://adminforth.dev/blog/k3s-ec2-deployment","mainEntityOfPage":"https://adminforth.dev/blog/k3s-ec2-deployment","url":"https://adminforth.dev/blog/k3s-ec2-deployment","headline":"IaC Simplified: K3s on EC2 Deployments with Terraform, Helm, Ansible & Amazon ECR","name":"IaC Simplified: K3s on EC2 Deployments with Terraform, Helm, Ansible & Amazon ECR","description":"The ultimate step-by-step guide to cost-effective, build-time-efficient, and easy managable EC2 deployments using K3s, Terraform, Helm, Ansible, and a Amazon ECR registry.","datePublished":"2025-11-04T00:00:00.000Z","author":{"@type":"Person","name":"Kyrylo Doropii","description":"DevOps Engineer of AdminForth","url":"https://github.com/kirilldorr","image":"https://avatars.githubusercontent.com/u/181721742?s=96&v=4"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://adminforth.dev/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Vue &amp; Node admin panel framework RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Vue &amp; Node admin panel framework Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-7K99Q2BH04"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-7K99Q2BH04",{anonymize_ip:!0})</script>



<link rel="search" type="application/opensearchdescription+xml" title="Vue &amp; Node admin panel framework" href="/opensearch.xml">

<script src="/scripts/adminforth.js"></script><link rel="stylesheet" href="/assets/css/styles.ba19fe4b.css">
<script src="/assets/js/runtime~main.787c6772.js" defer="defer"></script>
<script src="/assets/js/main.6a7c9473.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="AdminForth Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="AdminForth Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">AdminForth</b></a><a class="navbar__item navbar__link" href="/docs/tutorial/gettingStarted/">Tutorial</a><a class="navbar__item navbar__link" href="/docs/api/">API</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog/">Blog</a></div><div class="navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><a href="https://demo.adminforth.dev/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Live Demo<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/devforth/adminforth" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/k3s-ec2-deployment/">IaC Simplified: K3s on EC2 Deployments with Terraform, Helm, Ansible &amp; Amazon ECR</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/context7-setup-vscode/">How to set up Context7 MCP in Visual Studio Code</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/dynamic-strings-translation/">How to translate dynamic strings in AdminForth API</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/keycloak-setup-example/">Setup AdminForth Authorization via Keycloak</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/compose-aws-ec2-ecr-terraform-github-actions/">IaaC Simplified: Amazon EC2 Deployments with GitHub Actions, Terraform, Docker &amp; Amazon ECR</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">IaC Simplified: K3s on EC2 Deployments with Terraform, Helm, Ansible &amp; Amazon ECR</h1><div class="container_mt6G margin-vert--md"><time datetime="2025-11-04T00:00:00.000Z">November 4, 2025</time> · <!-- -->14 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/kirilldorr" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://avatars.githubusercontent.com/u/181721742?s=96&amp;v=4" alt="Kyrylo Doropii"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://github.com/kirilldorr" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Kyrylo Doropii</span></a></div><small class="authorTitle_nd0D" title="DevOps Engineer of AdminForth">DevOps Engineer of AdminForth</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>This guide shows how to deploy own Docker apps (with AdminForth as example) to Amazon EC2 instance with K3s and Terraform involving pushing images into Amazon ECR.</p>
<p>Needed resources:</p>
<ul>
<li>AWS account where we will auto-spawn EC2 instance. We will use <code>t3a.small</code> instance (2 vCPUs, 2GB RAM) which costs <code>~14$</code> per month in <code>us-west-2</code> region (cheapest region). Also it will take <code>$2</code> per month for EBS gp2 storage (20GB) for EC2 instance.</li>
<li>Also AWS ECR will charge for <code>$0.09</code> per GB of data egress traffic (from EC2 to the internet) - this needed to load docker build cache.</li>
</ul>
<p>The setup shape:</p>
<ul>
<li>Build is done using IaaC approach with HashiCorp Terraform, so almoast no manual actions are needed from you. Every resource including EC2 server instance is described in code which is commited to repo.</li>
<li>Docker images and build cache are stored on Amazon ECR</li>
<li>Total build time for average commit to AdminForth app (with Vite rebuilds) is around 3 minutes.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-exactly-k3s">Why exactly K3s?<a href="#why-exactly-k3s" class="hash-link" aria-label="Direct link to Why exactly K3s?" title="Direct link to Why exactly K3s?">​</a></h2>
<p>Previously, our blog featured posts about different types of application deployment, but without the use of Kubernetes. This post will look at the cheapest option for deploying an application using k3s (a lightweight version of k8s Kubernetes). This option is more interesting than most of the alternatives, primarily because of its automation and scalability (it is, of course, inferior to the “older” K8s, but it also requires significantly fewer resources).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-we-will-store-containers">How we will store containers?<a href="#how-we-will-store-containers" class="hash-link" aria-label="Direct link to How we will store containers?" title="Direct link to How we will store containers?">​</a></h2>
<p>The ECR repository will be used for storage. Since we are working with AWS, this is the most reliable option. The image must be assembled from local files on the machine and then sent to the Amazon server. All instructions for performing these actions will be provided below.</p>
<h1>Prerequisites</h1>
<p>I will assume you run Ubuntu (Native or WSL2).</p>
<p>You should have terraform, here is official repository:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">wget -O - https://apt.releases.hashicorp.com/gpg | sudo gpg --dearmor -o /usr/share/keyrings/hashicorp-archive-keyring.gpg</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">echo &quot;deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com $(lsb_release -cs) main&quot; | sudo tee /etc/apt/sources.list.d/hashicorp.list</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">sudo apt update &amp;&amp; sudo apt install terraform</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>AWS CLI:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#e6db74">sudo</span><span class="token plain"> snap </span><span class="token function" style="color:#e6db74">install</span><span class="token plain"> aws-cli </span><span class="token parameter variable" style="color:#f8f8f2">--classic</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>HELM:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#e6db74">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:#f8f8f2">-fsSL</span><span class="token plain"> </span><span class="token parameter variable" style="color:#f8f8f2">-o</span><span class="token plain"> get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-4</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#e6db74">chmod</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">700</span><span class="token plain"> get_helm.sh</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">./get_helm.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Also you need Doker Daemon running. We recommend Docker Desktop running. ON WSL2 make sure you have Docker Desktop WSL2 integration enabled.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#e6db74">docker</span><span class="token plain"> version</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It is also worth having <code>kubectl</code> locally on your machine for more convenient interaction with nodes and pods, but this is not mandatory.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#e6db74">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:#f8f8f2">-LO</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;https://dl.k8s.io/release/</span><span class="token string variable" style="color:#f8f8f2">$(</span><span class="token string variable function" style="color:#e6db74">curl</span><span class="token string variable" style="color:#f8f8f2"> </span><span class="token string variable parameter variable" style="color:#f8f8f2">-L</span><span class="token string variable" style="color:#f8f8f2"> </span><span class="token string variable parameter variable" style="color:#f8f8f2">-s</span><span class="token string variable" style="color:#f8f8f2"> https://dl.k8s.io/release/stable.txt</span><span class="token string variable" style="color:#f8f8f2">)</span><span class="token string" style="color:#a6e22e">/bin/linux/amd64/kubectl&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Last step is download ansible:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#e6db74">sudo</span><span class="token plain"> add-apt-repository </span><span class="token parameter variable" style="color:#f8f8f2">--yes</span><span class="token plain"> </span><span class="token parameter variable" style="color:#f8f8f2">--update</span><span class="token plain"> ppa:ansible/ansible</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#e6db74">sudo</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">apt</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">install</span><span class="token plain"> ansible </span><span class="token parameter variable" style="color:#f8f8f2">-y</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>Practice - deploy setup</h1>
<p>Assume you have your AdminForth project in <code>myadmin</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-1---create-a-ssh-keypair">Step 1 - create a SSH keypair<a href="#step-1---create-a-ssh-keypair" class="hash-link" aria-label="Direct link to Step 1 - create a SSH keypair" title="Direct link to Step 1 - create a SSH keypair">​</a></h2>
<p>Make sure you are still in <code>deploy</code> folder, run next command:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">deploy</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#e6db74">mkdir</span><span class="token plain"> .keys </span><span class="token operator" style="color:#66d9ef">&amp;&amp;</span><span class="token plain"> ssh-keygen </span><span class="token parameter variable" style="color:#f8f8f2">-f</span><span class="token plain"> .keys/id_rsa </span><span class="token parameter variable" style="color:#f8f8f2">-N</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now it should create <code>deploy/.keys/id_rsa</code> and <code>deploy/.keys/id_rsa.pub</code> files with your SSH keypair. Terraform script will put the public key to the EC2 instance and will use private key to connect to the instance. Also you will be able to use it to connect to the instance manually.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-2---gitignore-file">Step 2 - .gitignore file<a href="#step-2---gitignore-file" class="hash-link" aria-label="Direct link to Step 2 - .gitignore file" title="Direct link to Step 2 - .gitignore file">​</a></h2>
<p>Create <code>deploy/.gitignore</code> file with next content:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">.terraform/</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">.keys/</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">*.tfstate</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">*.tfstate.*</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">*.tfvars</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">tfplan</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">session-manager-plugin.deb</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">.terraform.lock.hcl</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-3---terraform-folder">Step 3 - Terraform folder<a href="#step-3---terraform-folder" class="hash-link" aria-label="Direct link to Step 3 - Terraform folder" title="Direct link to Step 3 - Terraform folder">​</a></h2>
<p>First of all install Terraform as described here <a href="https://developer.hashicorp.com/terraform/install#linux" target="_blank" rel="noopener noreferrer">terraform installation</a>.</p>
<p>After this create folder ../deploy/terraform</p>
<p>Create file <code>main.tf</code> in <code>deploy/terraform</code> folder:</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">deploy/terraform/main.tf</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">terraform {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  required_providers {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    aws = {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      source  = &quot;hashicorp/aws&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      version = &quot;~&gt; 5.0&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">locals {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  aws_region           = &quot;us-west-2&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  vpc_cidr             = &quot;10.0.0.0/16&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  subnet_a_cidr        = &quot;10.0.10.0/24&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  subnet_b_cidr        = &quot;10.0.11.0/24&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  az_a                 = &quot;us-west-2a&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  az_b                 = &quot;us-west-2b&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  app_name             = &lt;your_app_name&gt;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  app_source_code_path = &quot;../../&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  ansible_dir          = &quot;../ansible/playbooks&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  app_files            = fileset(local.app_source_code_path, &quot;**&quot;)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  image_tag = sha256(join(&quot;&quot;, [</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    for f in local.app_files :</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    try(filesha256(&quot;${local.app_source_code_path}/${f}&quot;), &quot;&quot;)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    if length(regexall(&quot;^deploy/&quot;, f)) == 0</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    &amp;&amp; length(regexall(&quot;^\\.vscode/&quot;, f)) == 0</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    &amp;&amp; length(regexall(&quot;^node_modules/&quot;, f)) == 0</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    &amp;&amp; length(regexall(&quot;^\\.gitignore&quot;, f)) == 0</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  ]))</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  ingress_ports = [</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    { from = 22, to = 22, protocol = &quot;tcp&quot;, desc = &quot;SSH&quot; },</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    { from = 80, to = 80, protocol = &quot;tcp&quot;, desc = &quot;App HTTP (Traefik)&quot; },</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    { from = 443, to = 443, protocol = &quot;tcp&quot;, desc = &quot;App HTTPS (Traefik)&quot; },</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    { from = 6443, to = 6443, protocol = &quot;tcp&quot;, desc = &quot;Kubernetes API&quot; }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">provider &quot;aws&quot; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  region  = local.aws_region</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  profile = &quot;myaws&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">data &quot;aws_ami&quot; &quot;ubuntu_22_04&quot; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  most_recent = true</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  owners      = [&quot;099720109477&quot;] # Canonical ubuntu account ID</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  filter {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    name   = &quot;name&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    values = [&quot;ubuntu/images/hvm-ssd/ubuntu-jammy-22.04-amd64-server-*&quot;]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">resource &quot;aws_key_pair&quot; &quot;app_deployer&quot; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  key_name   = &quot;terraform-deploy_${local.app_name}-key&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  public_key = file(&quot;../.keys/id_rsa.pub&quot;) # Path to your public SSH key</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">resource &quot;aws_instance&quot; &quot;ec2_instance&quot; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  instance_type = &quot;t3a.small&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  ami           = data.aws_ami.ubuntu_22_04.id</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  iam_instance_profile = aws_iam_instance_profile.instance_profile.name</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  subnet_id                   = aws_subnet.public_a.id</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  vpc_security_group_ids      = [aws_security_group.app_sg.id]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  associate_public_ip_address = true</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  key_name                    = aws_key_pair.app_deployer.key_name</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  tags = {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    Name = local.app_name</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  depends_on = [</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    null_resource.docker_build_and_push</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  # prevent accidental termination of ec2 instance and data loss</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  lifecycle {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    create_before_destroy = true #uncomment in production</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    #prevent_destroy       = true       #uncomment in production</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    ignore_changes = [ami]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    replace_triggered_by = [</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      null_resource.docker_build_and_push</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  root_block_device {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    volume_size = 10 // Size in GB for root partition</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    volume_type = &quot;gp2&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    # Even if the instance is terminated, the volume will not be deleted, delete it manually if needed</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    delete_on_termination = true #change to false in production if data persistence is needed</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">resource &quot;local_file&quot; &quot;ansible_inventory&quot; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  content = &lt;&lt;EOF</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">[k3s_nodes]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">${aws_instance.ec2_instance.public_ip} ansible_user=ubuntu ansible_ssh_private_key_file=../.keys/id_rsa</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  filename = &quot;../ansible/inventory.ini&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">resource &quot;null_resource&quot; &quot;wait_ssh&quot; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  depends_on = [aws_instance.ec2_instance]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  triggers = (</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      instance_id = aws_instance.ec2_instance.id</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  provisioner &quot;local-exec&quot; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    command = &lt;&lt;EOT</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    bash -c &#x27;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    for i in {1..10}; do</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      nc -zv ${aws_instance.ec2_instance.public_ip} 22 &amp;&amp; echo &quot;SSH is ready!&quot; &amp;&amp; exit 0</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      sleep 5</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    done</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    exit 1</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    &#x27;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    EOT</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">resource &quot;null_resource&quot; &quot;ansible_provision&quot; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  depends_on = [</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    aws_instance.ec2_instance,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    local_file.ansible_inventory,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    null_resource.wait_ssh,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    local_file.image_tag</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  triggers = {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    instance_id = aws_instance.ec2_instance.id</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  provisioner &quot;local-exec&quot; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    interpreter = [&quot;/bin/bash&quot;, &quot;-c&quot;]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    command = &lt;&lt;-EOT</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      set -e</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      ANSIBLE_HOST_KEY_CHECKING=False ansible-galaxy collection install community.kubernetes</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      ANSIBLE_HOST_KEY_CHECKING=False ansible-playbook -i ${path.module}/../ansible/inventory.ini ${local.ansible_dir}/playbook.yaml </span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    EOT</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>👆 Replace <code>&lt;your_app_name&gt;</code> with your app name (no spaces, only underscores or letters)</p>
</blockquote>
<p>We will also need a file <code>container.tf</code></p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">deploy/terraform/container.tf</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">resource &quot;aws_ecr_repository&quot; &quot;app_repo&quot; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  name = local.app_name</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  image_tag_mutability = &quot;MUTABLE&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  image_scanning_configuration {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    scan_on_push = true</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  force_delete = true</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">data &quot;aws_caller_identity&quot; &quot;current&quot; {}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">resource &quot;null_resource&quot; &quot;docker_build_and_push&quot; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  depends_on = [aws_ecr_repository.app_repo]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  triggers = {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    image_tag = local.image_tag</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  provisioner &quot;local-exec&quot; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    command = &lt;&lt;-EOT</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      set -e</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      unset DOCKER_HOST</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      REPO_URL=&quot;${aws_ecr_repository.app_repo.repository_url}&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      ACCOUNT_ID=&quot;${data.aws_caller_identity.current.account_id}&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      REGION=&quot;${local.aws_region}&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      TAG=&quot;${local.image_tag}&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      echo &quot;LOG: Logging in to ECR...&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      aws ecr get-login-password --region $${REGION} | docker login --username AWS --password-stdin $${ACCOUNT_ID}.dkr.ecr.$${REGION}.amazonaws.com</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      echo &quot;LOG: Building Docker image...&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      docker build --pull -t $${REPO_URL}:$${TAG} ${local.app_source_code_path}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      echo &quot;LOG: Pushing image to ECR...&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      docker push $${REPO_URL}:$${TAG}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      echo &quot;LOG: Build and push complete. TAG=$${TAG}&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    EOT</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    interpreter = [&quot;/bin/bash&quot;, &quot;-c&quot;]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">resource &quot;local_file&quot; &quot;image_tag&quot; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  depends_on = [null_resource.docker_build_and_push]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  content    = local.image_tag</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  filename   = &quot;${path.module}/image_tag.txt&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This file contains a script that builds the Docker image locally. This is done for more flexible deployment. When changing the program code, there is no need to manually update the image on EC2 or in the repository. It is updated automatically with each terraform apply. Below is a table showing the time it takes to build this image from scratch and with minimal changes.</p>
<table><thead><tr><th>Feature</th><th>Time</th></tr></thead><tbody><tr><td>Initial build time*</td><td>0m45.445s</td></tr><tr><td>Rebuild time (changed index.ts)*</td><td>0m26.757s</td></tr></tbody></table>
<sub>* All tests done from local machine (Intel(R) Core(TM) i7 9760H, Docker Desktop/Ubuntu 32 GB RAM, 300Mbps up/down) up to working state</sub>
<p>Also, <code>resvpc.tf</code></p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">deploy/terraform/resvpc.tf</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">resource &quot;aws_vpc&quot; &quot;main&quot; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  cidr_block = local.vpc_cidr</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  enable_dns_support   = true</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  enable_dns_hostnames = true</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  tags = { Name = &quot;main-vpc&quot; }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">resource &quot;aws_subnet&quot; &quot;public_a&quot; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  vpc_id                  = aws_vpc.main.id</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  cidr_block              = local.subnet_a_cidr</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  map_public_ip_on_launch = true</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  availability_zone       = local.az_a</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  tags = {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    Name = &quot;public-a&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">resource &quot;aws_subnet&quot; &quot;public_b&quot; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  vpc_id                  = aws_vpc.main.id</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  cidr_block              = local.subnet_b_cidr</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  map_public_ip_on_launch = true</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  availability_zone       = local.az_b</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  tags = {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    Name = &quot;public-b&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">resource &quot;aws_internet_gateway&quot; &quot;igw&quot; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  vpc_id = aws_vpc.main.id</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  tags   = { Name = &quot;main-igw&quot; }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">resource &quot;aws_route_table&quot; &quot;public_rt&quot; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  vpc_id = aws_vpc.main.id</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  route {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    cidr_block = &quot;0.0.0.0/0&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    gateway_id = aws_internet_gateway.igw.id</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  tags = { Name = &quot;public-rt&quot; }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">resource &quot;aws_route_table_association&quot; &quot;public_a_assoc&quot; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  subnet_id      = aws_subnet.public_a.id</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  route_table_id = aws_route_table.public_rt.id</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">resource &quot;aws_route_table_association&quot; &quot;public_b_assoc&quot; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  subnet_id      = aws_subnet.public_b.id</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  route_table_id = aws_route_table.public_rt.id</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">resource &quot;aws_security_group&quot; &quot;app_sg&quot; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  name   = &quot;${local.app_name}-SecurityGroup&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  vpc_id = aws_vpc.main.id</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  dynamic &quot;ingress&quot; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    for_each = local.ingress_ports</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    content {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      from_port   = ingress.value.from</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      to_port     = ingress.value.to</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      protocol    = ingress.value.protocol</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      cidr_blocks = [&quot;0.0.0.0/0&quot;]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      description = ingress.value.desc</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  egress {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    from_port   = 0</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    to_port     = 0</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    protocol    = &quot;-1&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    cidr_blocks = [&quot;0.0.0.0/0&quot;]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">resource &quot;aws_iam_role&quot; &quot;node_role&quot; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  name = &quot;${local.app_name}node-role&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  assume_role_policy = jsonencode({</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    Version = &quot;2012-10-17&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    Statement = [{</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      Effect    = &quot;Allow&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      Principal = { Service = &quot;ec2.amazonaws.com&quot; }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      Action    = &quot;sts:AssumeRole&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    }]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  })</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">resource &quot;aws_iam_role_policy_attachment&quot; &quot;ecr_read_only_attach&quot; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  policy_arn = &quot;arn:aws:iam::aws:policy/AmazonEC2ContainerRegistryReadOnly&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  role       = aws_iam_role.node_role.name</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">resource &quot;aws_iam_role_policy_attachment&quot; &quot;ssm_core_policy&quot; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  policy_arn = &quot;arn:aws:iam::aws:policy/AmazonSSMManagedInstanceCore&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  role       = aws_iam_role.node_role.name</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">resource &quot;aws_iam_instance_profile&quot; &quot;instance_profile&quot; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  name = &quot;${local.app_name}-instance-profile&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  role = aws_iam_role.node_role.name</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>And <code>outputs.tf</code></p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">deploy/terraform/outputs.tf</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">output &quot;app_endpoint&quot; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  value = &quot;http://${aws_instance.ec2_instance.public_dns}&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">output &quot;ssh_connect_command&quot; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  value = &quot;ssh -i .keys/id_rsa ubuntu@${aws_instance.ec2_instance.public_dns}&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-4---helm">Step 4 - Helm<a href="#step-4---helm" class="hash-link" aria-label="Direct link to Step 4 - Helm" title="Direct link to Step 4 - Helm">​</a></h3>
<p><strong>Helm</strong> is a command-line tool and a set of libraries that helps manage applications in Kubernetes.</p>
<p><strong>Helm Chart (Chart)</strong> is a package containing everything needed to run an application in Kubernetes. It&#x27;s the equivalent of <code>apt</code> or <code>yum</code> packages in Linux.</p>
<p>A chart has this structure:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">helm_charts/</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">├── Chart.yaml        # Metadata about the chart (name, version)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">├── values.yaml       # Default values (configuration)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">└── templates/        # Folder with Kubernetes templates (YAML files)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    ├── deployment.yaml</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    ├── service.yaml</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    ├── ingress.yaml</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    └── ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-5---provider-helm">Step 5 - Provider Helm<a href="#step-5---provider-helm" class="hash-link" aria-label="Direct link to Step 5 - Provider Helm" title="Direct link to Step 5 - Provider Helm">​</a></h3>
<p>Now we need to create .../deploy/helm and .../deploy/helm/helm_charts folders</p>
<p>you need to create a file <code>Chart.yaml</code> in it</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">deploy/helm/helm_charts/Chart.yaml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> v2</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">name</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> myadmink3s </span><span class="token comment" style="color:#8292a2;font-style:italic"># SET YOUR APP NAME</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">description</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> Helm chart for myadmin app</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">version</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> 0.1.0</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">appVersion</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;1.0.0&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>And <code>values.yaml</code></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">deploy/helm/helm_charts/values.yaml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token key atrule">appName</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> myadmink3s </span><span class="token comment" style="color:#8292a2;font-style:italic"># SET YOUR APP NAME LIKE IN Chart.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">appNameSpace</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> myadmin </span><span class="token comment" style="color:#8292a2;font-style:italic"># SET YOUR APP NAMESPACE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">containerPort</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">3500</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">servicePort</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">adminSecret</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;your_secret&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">ecrImageFull</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>After this create .../deploy/helm/helm_charts/templates folder</p>
<p>And create files here:</p>
<p><code>deployment.yaml</code></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">deploy/helm/helm_charts/templates/deployment.yaml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> .Values.appName </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain">deployment</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> .Values.appNameSpace </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">replicas</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token key atrule">matchLabels</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token key atrule">app</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> .Values.appName </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">template</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token key atrule">app</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> .Values.appName </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> .Values.appName </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token key atrule">image</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;{{ .Values.ecrImageFull }}&quot;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token key atrule">containerPort</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> .Values.containerPort </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token key atrule">env</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;ADMINFORTH_SECRET&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token key atrule">value</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;{{ .Values.adminSecret }}&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>ingress.yaml</code></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">deploy/helm/helm_charts/templates/ingress.yaml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> networking.k8s.io/v1</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> Ingress</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> .Values.appName </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain">ingress</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> .Values.appNameSpace </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">rules</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token key atrule">http</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token key atrule">paths</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token key atrule">path</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> /</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token key atrule">pathType</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> Prefix</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token key atrule">backend</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token key atrule">service</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> .Values.appName </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token key atrule">port</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">              </span><span class="token key atrule">number</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> .Values.servicePort </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>And <code>service.yaml</code></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">deploy/helm/helm_charts/templates/service.yaml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> .Values.appName </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> .Values.appNameSpace </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">type</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> ClusterIP</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token key atrule">app</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> .Values.appName </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token key atrule">port</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> .Values.servicePort </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token key atrule">targetPort</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> .Values.containerPort </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The comments in the <code>values.yaml</code> and <code>Chart.yaml</code> files indicate the names of the variables that need to be replaced. They must correspond to the variables in Ansible, which will be discussed later.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-6---ansible">Step 6 - Ansible<a href="#step-6---ansible" class="hash-link" aria-label="Direct link to Step 6 - Ansible" title="Direct link to Step 6 - Ansible">​</a></h3>
<p>If we explain the logic of deployment, Ansible plays a very important role here. If Terraform is used exclusively to configure cloud infrastructure in AWS, Ansible prepares it for the deployment of a Kubernetes cluster. Ansible Playbooks, in simple terms, are templates for configuring the system (of course, their functionality is much broader, but in this deployment method and in most cases, this is how they are used). That is, after preparing the instance with Terraform, it launches Ansible, which prepares it for the deployment of the Kubernetes cluster, after which it launches Helm.
This method allows for the highest quality deployment, because each stage is handled by software specialized for that particular stage.</p>
<p>So, create <code>/deploy/ansible/playbooks</code> folder</p>
<p>Then the file <code>playbook.yaml</code></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">/deploy/ansible/playbooks/playbook.yaml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">---</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">- name: Deploy application</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  hosts: k3s_nodes</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  become: </span><span class="token boolean" style="color:#ae81ff">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  vars:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    k3s_version: </span><span class="token string" style="color:#a6e22e">&quot;v1.27.3+k3s1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    helm_version: </span><span class="token string" style="color:#a6e22e">&quot;v3.12.3&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    kubeconfig_path: /etc/rancher/k3s/k3s.yaml</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    helm_url: https://get.helm.sh/helm-v3.12.3-linux-amd64.tar.gz</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    helm_dest: /usr/local/bin/helm</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    app_name: myadmink3s    </span><span class="token comment" style="color:#8292a2;font-style:italic"># &lt;-- CHANGE TO YOUR APP NAME LIKE IN main.tf local.app_name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    app_namespace: myadmin  </span><span class="token comment" style="color:#8292a2;font-style:italic"># &lt;-- CHANGE TO YOUR APP NAMESPACE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    aws_account_id: </span><span class="token string" style="color:#a6e22e">&quot;735356255780&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#8292a2;font-style:italic"># &lt;-- CHANGE TO YOUR AWS ACCOUNT ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    chart_path: /home/ubuntu/</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain">app_name</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain">/helm_charts</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  tasks:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    - name: Read Docker image tag </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">local</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      ansible.builtin.set_fact:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        image_tag: </span><span class="token string" style="color:#a6e22e">&quot;{{ lookup(&#x27;file&#x27;, &#x27;../../terraform/image_tag.txt&#x27;) }}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      delegate_to: localhost</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    - name: Install </span><span class="token function" style="color:#e6db74">unzip</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      ansible.builtin.apt:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        name: </span><span class="token function" style="color:#e6db74">unzip</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        state: present</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        update_cache: </span><span class="token boolean" style="color:#ae81ff">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    - name: Download AWS CLI v2</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      ansible.builtin.get_url:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        url: </span><span class="token string" style="color:#a6e22e">&quot;https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        dest: /tmp/awscliv2.zip</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        mode: </span><span class="token string" style="color:#a6e22e">&#x27;0644&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    - name: Unzip AWS CLI</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      ansible.builtin.unarchive:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        src: /tmp/awscliv2.zip</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        dest: /tmp</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        remote_src: </span><span class="token boolean" style="color:#ae81ff">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    - name: Install AWS CLI</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      ansible.builtin.command: /tmp/aws/install </span><span class="token parameter variable" style="color:#f8f8f2">--update</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      args:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        creates: /usr/local/bin/aws</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    - name: Update </span><span class="token function" style="color:#e6db74">apt</span><span class="token plain"> cache</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      ansible.builtin.apt:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        update_cache: </span><span class="token boolean" style="color:#ae81ff">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    - name: Install required packages</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      ansible.builtin.apt:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        name:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          - </span><span class="token function" style="color:#e6db74">curl</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          - </span><span class="token function" style="color:#e6db74">sudo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          - software-properties-common</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          - apt-transport-https</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          - ca-certificates</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        state: present</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    - name: Download k3s installation script</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      ansible.builtin.get_url:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        url: https://get.k3s.io</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        dest: /tmp/install_k3s.sh</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        mode: </span><span class="token string" style="color:#a6e22e">&#x27;0700&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    - name: Install k3s</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      ansible.builtin.command: /tmp/install_k3s.sh</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      environment:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        INSTALL_K3S_VERSION: </span><span class="token string" style="color:#a6e22e">&quot;{{ k3s_version }}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      args:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        creates: /usr/local/bin/k3s</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    - name: Get ECR token</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      ansible.builtin.command: aws ecr get-login-password </span><span class="token parameter variable" style="color:#f8f8f2">--region</span><span class="token plain"> us-west-2</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      register: ecr_token</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      changed_when: </span><span class="token boolean" style="color:#ae81ff">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    - name: Configure K3s registry </span><span class="token keyword" style="color:#66d9ef">for</span><span class="token plain"> ECR</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      ansible.builtin.copy:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        dest: /etc/rancher/k3s/registries.yaml</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        content: </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          configs:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token string" style="color:#a6e22e">&quot;735356255780.dkr.ecr.us-west-2.amazonaws.com&quot;</span><span class="token builtin class-name" style="color:#e6db74">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">              auth:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                username: AWS</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                password: </span><span class="token string" style="color:#a6e22e">&quot;{{ ecr_token.stdout }}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        mode: </span><span class="token string" style="color:#a6e22e">&#x27;0600&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    - name: Restart k3s to apply registry changes</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      ansible.builtin.systemd:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        name: k3s</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        state: restarted</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        enabled: </span><span class="token boolean" style="color:#ae81ff">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    - name: Wait </span><span class="token keyword" style="color:#66d9ef">for</span><span class="token plain"> k3s </span><span class="token function" style="color:#e6db74">node</span><span class="token plain"> to be ready</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      ansible.builtin.wait_for:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        path: /usr/local/bin/k3s</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        state: present</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        timeout: </span><span class="token number" style="color:#ae81ff">300</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    - name: Ensure ~/.kube directory exists</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      ansible.builtin.file:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        path: /root/.kube</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        state: directory</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        mode: </span><span class="token string" style="color:#a6e22e">&#x27;0700&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    - name: Copy k3s kubeconfig</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      ansible.builtin.copy:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        remote_src: </span><span class="token boolean" style="color:#ae81ff">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        src: /etc/rancher/k3s/k3s.yaml</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        dest: /root/.kube/config</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        owner: root</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        group: root</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        mode: </span><span class="token string" style="color:#a6e22e">&#x27;0600&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    - name: Replace localhost with public IP </span><span class="token keyword" style="color:#66d9ef">in</span><span class="token plain"> kubeconfig</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      ansible.builtin.replace:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        path: /root/.kube/config</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        regexp: </span><span class="token string" style="color:#a6e22e">&quot;server: https://127.0.0.1:6443&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        replace: </span><span class="token string" style="color:#a6e22e">&quot;server: https://{{ inventory_hostname }}:6443&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    - name: Download Helm tarball</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      ansible.builtin.get_url:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        url: </span><span class="token string" style="color:#a6e22e">&quot;https://get.helm.sh/helm-{{ helm_version }}-linux-amd64.tar.gz&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        dest: </span><span class="token string" style="color:#a6e22e">&quot;/tmp/helm.tar.gz&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        mode: </span><span class="token string" style="color:#a6e22e">&#x27;0644&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    - name: Extract Helm tarball</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      ansible.builtin.unarchive:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        src: </span><span class="token string" style="color:#a6e22e">&quot;/tmp/helm.tar.gz&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        dest: </span><span class="token string" style="color:#a6e22e">&quot;/tmp/&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        remote_src: </span><span class="token boolean" style="color:#ae81ff">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    - name: Move Helm binary to /usr/local/bin</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      ansible.builtin.command:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        cmd: </span><span class="token function" style="color:#e6db74">mv</span><span class="token plain"> /tmp/linux-amd64/helm /usr/local/bin/helm</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        creates: /usr/local/bin/helm</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    - name: Ensure python3-pip is installed</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      ansible.builtin.apt:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        name: python3-pip</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        state: present</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        update_cache: </span><span class="token boolean" style="color:#ae81ff">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    - name: Install Python kubernetes library</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      ansible.builtin.pip:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        name: kubernetes</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        executable: pip3</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    - name: Extract Helm binary</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      ansible.builtin.unarchive:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        src: /tmp/helm.tar.gz</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        dest: /tmp</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        remote_src: </span><span class="token boolean" style="color:#ae81ff">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        extra_opts: </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">--strip-components</span><span class="token operator" style="color:#66d9ef">=</span><span class="token number" style="color:#ae81ff">1</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        creates: /tmp/helm</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    - name: Move Helm binary to /usr/local/bin</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      ansible.builtin.command:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        cmd: </span><span class="token function" style="color:#e6db74">mv</span><span class="token plain"> /tmp/helm /usr/local/bin/helm</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        creates: /usr/local/bin/helm</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    - name: Copy Helm chart to server</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      ansible.builtin.copy:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        src: </span><span class="token string" style="color:#a6e22e">&quot;../../helm/helm_charts&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        dest: /home/ubuntu/</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> app_name </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        owner: ubuntu</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        group: ubuntu</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        mode: </span><span class="token string" style="color:#a6e22e">&#x27;0755&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        force: </span><span class="token boolean" style="color:#ae81ff">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    - name: Ensure namespace exists - </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> app_namespace </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      kubernetes.core.k8s:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        api_version: v1</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        kind: Namespace</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        name: </span><span class="token string" style="color:#a6e22e">&quot;{{ app_namespace }}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        kubeconfig: </span><span class="token string" style="color:#a6e22e">&quot;{{ kubeconfig_path }}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    - name: Deploy stack via Helm - </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> app_name </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      kubernetes.core.helm:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        name: </span><span class="token string" style="color:#a6e22e">&quot;{{ app_namespace }}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        chart_ref: /home/ubuntu/</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> app_name </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain">/helm_charts</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        release_namespace: </span><span class="token string" style="color:#a6e22e">&quot;{{ app_namespace }}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        kubeconfig: </span><span class="token string" style="color:#a6e22e">&quot;{{ kubeconfig_path }}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        create_namespace: </span><span class="token boolean" style="color:#ae81ff">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        values_files:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          - /home/ubuntu/</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> app_name </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain">/helm_charts/values.yaml</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        values:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          ecrImageFull: </span><span class="token string" style="color:#a6e22e">&quot;{{ aws_account_id }}.dkr.ecr.us-west-2.amazonaws.com/{{ app_name }}:{{ image_tag }}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        force: </span><span class="token boolean" style="color:#ae81ff">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        atomic: </span><span class="token boolean" style="color:#ae81ff">false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-7---configure-aws-profile">Step 7 - Configure AWS Profile<a href="#step-7---configure-aws-profile" class="hash-link" aria-label="Direct link to Step 7 - Configure AWS Profile" title="Direct link to Step 7 - Configure AWS Profile">​</a></h3>
<p>Open or create file <code>~/.aws/credentials</code> and add (if not already there):</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">[myaws]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">aws_access_key_id = &lt;your_access_key&gt;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">aws_secret_access_key = &lt;your_secret_key&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Then use</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">aws configure</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>And configure your AWS credentials</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-8---run-deployment">Step 8 - Run deployment<a href="#step-8---run-deployment" class="hash-link" aria-label="Direct link to Step 8 - Run deployment" title="Direct link to Step 8 - Run deployment">​</a></h3>
<p>All deployment-related actions are automated, so no additional actions are required. To deploy the application, you only need to enter a few commands listed below and wait a few minutes. After that, you will be able to connect to the web application using the link you will receive in <code>terraform_output</code>. Next, if you wish, you can add GitHub Actions. To do this, follow the instructions in <a href="https://adminforth.dev/blog/compose-aws-ec2-ecr-terraform-github-actions/#chellenges-when-you-build-on-ci" target="_blank" rel="noopener noreferrer">our other post</a>.</p>
<p>In ../deploy/terraform folder</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">terraform init</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">terraform apply -auto-approve</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="all-done">All done!<a href="#all-done" class="hash-link" aria-label="Direct link to All done!" title="Direct link to All done!">​</a></h3>
<p>Your application is now deployed on Amazon EC2 and available on the Internet.</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a title="Amazon Web Services (AWS) is a cloud computing platform that provides a wide range of services for building and deploying applications." class="tag_zVej tagRegular_sFm0" href="/blog/tags/aws/">AWS</a></li><li class="tag_QGVx"><a title="Terraform is an open-source infrastructure as code software tool created by HashiCorp that enables users to define and provision data center infrastructure using a declarative configuration language." class="tag_zVej tagRegular_sFm0" href="/blog/tags/terraform/">Terraform</a></li><li class="tag_QGVx"><a title="The package manager for Kubernetes" class="tag_zVej tagRegular_sFm0" href="/blog/tags/helm/">Helm</a></li><li class="tag_QGVx"><a title="k3s is a lightweight version of k8s (kubernetes) that is also used for container orchestration but uses fewer resources." class="tag_zVej tagRegular_sFm0" href="/blog/tags/k3s/">k3s</a></li><li class="tag_QGVx"><a title="Ansible is an open-source automation tool used for configuration management, application deployment, and task automation." class="tag_zVej tagRegular_sFm0" href="/blog/tags/ansible/">Ansible</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--next" href="/blog/context7-setup-vscode/"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">How to set up Context7 MCP in Visual Studio Code</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#why-exactly-k3s" class="table-of-contents__link toc-highlight">Why exactly K3s?</a></li><li><a href="#how-we-will-store-containers" class="table-of-contents__link toc-highlight">How we will store containers?</a></li><li><a href="#step-1---create-a-ssh-keypair" class="table-of-contents__link toc-highlight">Step 1 - create a SSH keypair</a></li><li><a href="#step-2---gitignore-file" class="table-of-contents__link toc-highlight">Step 2 - .gitignore file</a></li><li><a href="#step-3---terraform-folder" class="table-of-contents__link toc-highlight">Step 3 - Terraform folder</a><ul><li><a href="#step-4---helm" class="table-of-contents__link toc-highlight">Step 4 - Helm</a></li><li><a href="#step-5---provider-helm" class="table-of-contents__link toc-highlight">Step 5 - Provider Helm</a></li><li><a href="#step-6---ansible" class="table-of-contents__link toc-highlight">Step 6 - Ansible</a></li><li><a href="#step-7---configure-aws-profile" class="table-of-contents__link toc-highlight">Step 7 - Configure AWS Profile</a></li><li><a href="#step-8---run-deployment" class="table-of-contents__link toc-highlight">Step 8 - Run deployment</a></li><li><a href="#all-done" class="table-of-contents__link toc-highlight">All done!</a></li></ul></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/tutorial/gettingStarted/">Tutorial</a></li><li class="footer__item"><a href="https://demo.adminforth.dev/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Live Demo</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/api/">API</a></li><li class="footer__item"><a class="footer__link-item" href="/blog/archive/">Blog Archive</a></li><li class="footer__item"><a class="footer__link-item" href="/search/">Find anything</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://devforth.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">DevForth.io<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://devforth.io/contact" target="_blank" rel="noopener noreferrer" class="footer__link-item">We can develop admin panel for your project<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/devforth/adminforth" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 Devforth sp. z o.o.</div></div></div></footer></div>
</body>
</html>